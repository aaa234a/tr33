<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Rail Builder Pro</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.js"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.css"
    />
    <!-- Font Awesome for icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
    />
    <!-- GeoTIFF.js を追加 -->
    <script src="https://cdn.jsdelivr.net/npm/geotiff@2.0.7/dist-browser/geotiff.js"></script>
    <!-- LZ-String を追加: セーブデータを圧縮・解凍するために使用 -->
    <script src="https://cdn.jsdelivr.net/npm/lz-string@1.4.4/libs/lz-string.min.js"></script>

    <style>
      /* 基本的なスタイル */
      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background-color: #f8f9fa; /* 全体の背景色 */
        color: #333;
        overflow: hidden; /* チュートリアル表示時にスクロールバーが出ないように */
      }
      #map {
        height: 100%;
        width: 100%;
        cursor: default;
      }
      /* 建設モード中のカーソル */
      #map.build-mode-cursor {
        cursor: crosshair;
      }

      /* カスタムスクロールバー (Webkit系ブラウザ) */
      ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }
      ::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 10px;
      }
      ::-webkit-scrollbar-thumb {
        background: #888;
        border-radius: 10px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #555;
      }

      /* トップレベルのパネル (left-panel, finance-panel) */
      .panel {
        position: absolute;
        z-index: 1000;
        background: rgba(255, 255, 255, 0.95); /* 背景を少し不透明に */
        padding: 15px; /* パディングを増やす */
        border-radius: 10px; /* 角を丸く */
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2); /* 影を強調 */
        border: 1px solid #e0e0e0; /* 軽いボーダー */
        transition: all 0.3s ease-out; /* 開閉アニメーション用 */
      }
      #left-panel {
        top: 15px;
        left: 15px;
        width: 280px; /* 幅を少し広げる */
        max-height: calc(100% - 30px); /* 画面の高さに合わせて最大高さを設定 */
        overflow-y: auto; /* 内容が多い場合にスクロール可能に */
        display: flex;
        flex-direction: column;
        gap: 15px; /* 子パネル間のスペースを増やす */
      }
      #left-panel.collapsed {
        width: 60px; /* 最小幅をボタンより大きく変更 */
        height: 60px; /* max-heightではなくheightで固定に変更 */
        overflow: hidden;
        padding: 0;
      }
      #left-panel.collapsed > *:not(.panel-toggle-btn) {
        display: none; /* 開閉ボタン以外を非表示 */
      }

      .panel-toggle-btn {
        position: absolute;
        top: 0px;
        right: 0px;
        width: 40px;
        height: 40px;
        background: #007bff;
        color: white;
        border: none;
        border-radius: 0 10px 0 10px;
        cursor: pointer;
        font-size: 1.2em;
        line-height: 40px;
        text-align: center;
        transition: background 0.2s;
        z-index: 1001; /* パネルコンテンツより手前 */
      }
      .panel-toggle-btn:hover {
        background: #0056b3;
      }
      #left-panel.collapsed .panel-toggle-btn {
        border-radius: 10px; /* 全体が丸くなるように */
        top: 10px; /* 閉じた状態でのボタンの位置調整 */
        right: 10px; /* 閉じた状態でのボタンの位置調整 */
      }

      #finance-panel {
        top: 15px;
        right: 15px;
        width: 220px; /* 幅を少し広げる */
        text-align: right; /* テキストを右寄せ */
        font-size: 1.1em;
        font-weight: bold;
        color: #007bff; /* 強調色 */
      }
      #finance-panel span {
        color: #28a745; /* 資産の色 */
      }
      #message-bar {
        position: absolute;
        bottom: 25px; /* 下からの位置を少し上げる */
        left: 50%;
        transform: translateX(-50%);
        z-index: 1000;
        background: rgba(0, 0, 0, 0.85); /* 背景をより濃く */
        color: white;
        padding: 10px 20px; /* パディングを増やす */
        border-radius: 25px; /* 角をさらに丸く */
        font-size: 1.1em;
        opacity: 0;
        transition: opacity 0.4s ease-in-out, background-color 0.3s, color 0.3s; /* トランジションを長く */
        pointer-events: none;
        white-space: nowrap;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
      }
      #message-bar.success {
        background-color: rgba(40, 167, 69, 0.9);
      }
      #message-bar.warning {
        background-color: rgba(255, 193, 7, 0.9);
        color: #333;
      }
      #message-bar.error {
        background-color: rgba(220, 53, 69, 0.9);
      }

      /* left-panel の子要素のパネル (build-menu, finance-panel) */
      /* これらはFlexアイテムとしてレイアウトされるため、positionはstatic */
      #left-panel > .panel {
        background: #fdfdfd; /* 子パネルの背景色 */
        padding: 15px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); /* 軽い影 */
        position: static; /* 絶対配置を解除 */
        width: auto; /* 幅を親に合わせる */
        margin-bottom: 0; /* gapでスペースを確保するため不要 */
        border: 1px solid #f0f0f0;
      }
      #left-panel > .panel h3 {
        margin-top: 0;
        margin-bottom: 15px;
        color: #007bff;
        font-size: 1.2em;
        border-bottom: 2px solid #eee;
        padding-bottom: 8px;
        border-left: 5px solid #007bff; /* パネルヘッダーの強調 */
        padding-left: 10px;
      }
      #left-panel > .panel h4 {
        margin-top: 15px;
        margin-bottom: 10px;
        color: #555;
        font-size: 1em;
      }

      /* マップ上の表示物 */
      /* 線路のレール */
      .track-rail {
        color: #b0b0b0; /* レール色 */
        weight: 2;
        opacity: 0.9;
        lineCap: butt; /* 端を四角に */
        z-index: 10; /* 枕木より上 */
      }
      /* 線路の枕木 */
      .track-sleeper {
        color: #5a4b40; /* 枕木色 */
        weight: 8; /* 枕木は太く */
        opacity: 0.9;
        dashArray: "1 10"; /* 短い線と長い間隔で枕木を表現 */
        lineCap: butt;
        z-index: 5; /* レールより下 */
      }

      /* 高架線路の見た目 */
      .track-viaduct-rail {
        color: #c0c0c0;
      }
      .track-viaduct-sleeper {
        color: #706050;
      }
      /* トンネル線路の見た目 */
      .track-tunnel-rail {
        color: #808080;
      }
      .track-tunnel-sleeper {
        color: #403020;
      }

      /* 駅ホーム本体 */
      .station-platform-body {
        color: #a0a0a0; /* コンクリート色 */
        weight: 10; /* ホーム本体は太く */
        opacity: 0.9;
        lineCap: butt;
        z-index: 15; /* レールより上 */
      }
      /* 駅ホームの縁 */
      .station-platform-edge {
        color: #ffffff; /* 白線 */
        weight: 2; /* 細い縁 */
        opacity: 1;
        lineCap: butt;
        z-index: 20; /* ホーム本体より上 */
      }

      .station-marker {
        width: 16px;
        height: 16px;
        border-radius: 50%;
        background: #d9534f;
        border: 2px solid #fff;
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
        cursor: pointer;
        transition: transform 0.1s ease-out; /* ホバー時のアニメーション */
        display: flex; /* 中央に数字を配置 */
        justify-content: center;
        align-items: center;
        font-size: 0.8em;
        font-weight: bold;
        color: white;
      }
      .station-marker:hover {
        transform: scale(1.2); /* ホバーで少し拡大 */
      }
      .station-marker.selected-for-line {
        background: #007bff; /* 路線設定で選択された駅の色 */
        border-color: #007bff;
        box-shadow: 0 0 8px rgba(0, 123, 255, 0.7);
      }
      /* 路線設定で選択された駅マーカーのスタイルをさらに調整（駅クリック時に適用される）*/
      .station-marker-selectable {
        cursor: pointer;
      }

      /* 駅名ツールチップ */
      .station-name-tooltip {
        background-color: rgba(0, 0, 0, 0.7);
        color: white;
        border: none;
        border-radius: 5px;
        padding: 4px 8px;
        font-size: 0.9em;
        white-space: nowrap;
        pointer-events: none; /* クリックイベントを通過させる */
      }
      .station-name-tooltip::before {
        border-top-color: rgba(0, 0, 0, 0.7) !important;
      }

      /* 解体モードで選択されたオブジェクトのスタイル */
      .selected-for-demolition {
        animation: pulse 1s infinite alternate; /* 点滅アニメーション */
      }
      @keyframes pulse {
        from {
          outline: 3px solid rgba(220, 53, 69, 0.5);
          box-shadow: 0 0 10px rgba(220, 53, 69, 0.3);
        }
        to {
          outline: 3px solid rgba(220, 53, 69, 1);
          box-shadow: 0 0 15px rgba(220, 53, 69, 0.8);
        }
      }

      .station-marker.selected-for-demolition {
        background: #dc3545; /* マーカーも赤く */
        border-color: #dc3545;
      }

      .line-color {
        weight: 5;
        dasharray: "";
        opacity: 0.8;
      }

      /* ボタンのスタイル */
      button {
        margin: 4px 0; /* マージンを調整 */
        padding: 10px 15px; /* パディングを増やす */
        border-radius: 5px; /* 角を丸く */
        cursor: pointer;
        border: 1px solid #007bff; /* メインカラーのボーダー */
        background: #007bff; /* メインカラーの背景 */
        color: white; /* 文字色を白に */
        font-weight: bold;
        transition: background 0.2s, color 0.2s, border-color 0.2s,
          box-shadow 0.2s, transform 0.2s;
        width: 100%;
        box-sizing: border-box;
        box-shadow: 0 2px 4px rgba(0, 123, 255, 0.2);
        display: flex; /* アイコンとテキストを中央揃え */
        align-items: center;
        justify-content: center;
      }
      button i {
        margin-right: 8px; /* アイコンとテキストの間隔 */
      }
      button:hover {
        background: #0056b3; /* ホバーで少し暗く */
        border-color: #0056b3;
        box-shadow: 0 4px 8px rgba(0, 123, 255, 0.3);
        transform: translateY(-2px); /* 浮き上がるエフェクト */
      }
      button.active {
        background: #28a745; /* アクティブなボタンは緑色に */
        border-color: #28a745;
        box-shadow: 0 2px 4px rgba(40, 167, 69, 0.3);
        transform: translateY(0); /* 浮き上がりをリセット */
      }
      button.active:hover {
        background: #218838;
        border-color: #218838;
      }
      button:disabled {
        background: #e9ecef;
        color: #6c757d;
        cursor: not-allowed;
        border-color: #dee2e6;
        box-shadow: none;
        transform: translateY(0);
      }
      /* 特定のボタンのスタイル調整 */
      #confirm-build,
      #confirm-line-build,
      #confirm-demolition {
        background: #ffc107; /* 確定ボタンは警告色 */
        border-color: #ffc107;
        color: #333;
      }
      #confirm-build:hover,
      #confirm-line-build:hover,
      #confirm-demolition:hover {
        background: #e0a800;
        border-color: #e0a800;
      }
      #cancel-line-build,
      #cancel-demolition {
        background: #dc3545; /* キャンセルボタンは危険色 */
        border-color: #dc3545;
      }
      #cancel-line-build:hover,
      #cancel-demolition:hover {
        background: #c82333;
      }
      #demolition-mode-btn {
        background: #6c757d; /* 解体モードは灰色 */
        border-color: #6c757d;
      }
      #demolition-mode-btn:hover {
        background: #5a6268;
        border-color: #5a6268;
      }
      #demolition-mode-btn.active {
        background: #dc3545; /* アクティブな解体モードは赤 */
        border-color: #dc3545;
      }
      #demolition-mode-btn.active:hover {
        background: #c82333;
        border-color: #c82333;
      }

      /* ゲーム速度ボタンの調整 */
      #game-speed-control button {
        width: calc(25% - 5px); /* 4つ並べる */
        display: inline-flex; /* flexに変更 */
        margin-right: 5px;
      }
      #game-speed-control button:last-child {
        margin-right: 0;
      }

      hr {
        border: none;
        border-top: 1px solid #eee;
        margin: 15px 0;
      }

      /* 列車ショップ */
      #train-list,
      #bought-trains-list {
        max-height: 250px; /* 高さを調整 */
        overflow-y: auto;
        border: 1px solid #ddd; /* ボーダーを調整 */
        border-radius: 6px;
        padding: 8px;
        margin-bottom: 10px;
        background: #fff;
      }
      .train-item {
        display: flex;
        align-items: center;
        padding: 10px;
        margin-bottom: 6px;
        border: 1px solid #eee;
        border-radius: 5px;
        cursor: pointer;
        background: #f9f9f9;
        transition: background 0.2s, border-color 0.2s, box-shadow 0.2s;
      }
      .train-item:hover {
        background: #f0f0f0;
        border-color: #ccc;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
      }
      .train-item.selected {
        border-color: #007bff;
        background: #e7f3ff;
        box-shadow: 0 2px 8px rgba(0, 123, 255, 0.2);
      }
      .train-item i {
        font-size: 1.5em;
        margin-right: 12px;
        color: #666;
      }
      .train-item-color-box {
        width: 24px; /* サイズを少し大きく */
        height: 24px;
        border-radius: 4px;
        margin-right: 12px;
        border: 1px solid #ccc;
        flex-shrink: 0; /* 縮まないように */
      }
      .train-item-details {
        flex-grow: 1;
      }
      .train-item-details h4 {
        margin: 0;
        font-size: 1.1em;
        color: #333;
      }
      .train-item-details p {
        margin: 0;
        font-size: 0.85em;
        color: #666;
      }

      /* 路線設定 */
      #selected-stations-list {
        max-height: 180px; /* 高さを調整 */
        overflow-y: auto;
        border: 1px solid #ddd;
        border-radius: 6px;
        padding: 8px;
        margin-bottom: 10px;
        background: #fff;
      }
      .selected-station-item {
        padding: 8px;
        margin-bottom: 5px;
        background: #f0f8ff; /* 選択された駅の背景色 */
        border: 1px solid #b0e0e6;
        border-radius: 4px;
        font-size: 0.95em;
        color: #444;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .selected-station-item span {
        font-weight: bold;
        margin-right: 8px;
        color: #007bff;
      }
      .selected-station-item button {
        width: auto;
        padding: 4px 10px;
        font-size: 0.8em;
        margin: 0;
        background: #dc3545;
        color: white;
        border: none;
        box-shadow: none;
      }
      .selected-station-item button:hover {
        background: #c82333;
      }

      /* 列車車両 */
      .train-car-container {
        /* L.divIconのルート要素。iconSizeで指定されるサイズ */
        display: flex;
        justify-content: center;
        align-items: center;
        pointer-events: none; /* マップ操作の邪魔にならないように */
        /* 画像を直接表示するため、train-car-bodyや::afterのスタイルは不要 */
      }
      /* train-car-body クラスはもう使わないので削除
      .train-car-body {
        border-radius: 2px;
        box-shadow: 0 0 3px rgba(0, 0, 0, 0.5);
        border: 1px solid rgba(0, 0, 0, 0.2);
        position: relative;
      }
      .train-car-body.front-car::after {
        content: "";
        position: absolute;
        width: 0;
        height: 0;
        border-left: 8px solid transparent;
        border-right: 8px solid transparent;
        border-bottom: 12px solid white;
        top: -12px;
        left: 50%;
        transform: translateX(-50%);
        box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.3);
      }
      */
      .train-car-container img {
        /* 画像がコンテナに収まるように */
        max-width: 100%;
        max-height: 100%;
        object-fit: contain;
        display: block; /* 余白をなくす */
      }

      /* 建設コスト表示ツールチップ */
      .construction-cost-tooltip {
        position: absolute;
        background-color: rgba(0, 0, 0, 0.75);
        color: white;
        padding: 5px 10px;
        border-radius: 5px;
        font-size: 0.9em;
        white-space: nowrap;
        pointer-events: none;
        z-index: 1000;
        transform: translate(-50%, -120%); /* マウスカーソルから少しずらす */
      }

      /* ロード中のスピナー */
      #loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        color: white;
        font-size: 1.5em;
        flex-direction: column;
        gap: 20px;
        transition: opacity 0.3s ease-in-out;
      }
      .spinner {
        border: 8px solid #f3f3f3; /* Light grey */
        border-top: 8px solid #3498db; /* Blue */
        border-radius: 50%;
        width: 60px;
        height: 60px;
        animation: spin 2s linear infinite;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* チュートリアルモーダル */
      #tutorial-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.8);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 2000;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
      }
      #tutorial-overlay.show {
        opacity: 1;
        visibility: visible;
      }
      #tutorial-modal {
        background: #fff;
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        max-width: 600px;
        width: 90%;
        text-align: center;
        transform: translateY(-20px);
        transition: transform 0.3s ease-in-out;
      }
      #tutorial-overlay.show #tutorial-modal {
        transform: translateY(0);
      }
      #tutorial-modal h2 {
        color: #007bff;
        font-size: 2em;
        margin-bottom: 20px;
        border-bottom: 2px solid #eee;
        padding-bottom: 10px;
      }
      #tutorial-modal p {
        font-size: 1.1em;
        line-height: 1.6;
        color: #555;
        margin-bottom: 20px;
      }
      .tutorial-navigation-buttons button {
        width: auto;
        padding: 10px 20px;
        margin: 0 10px;
        font-size: 1em;
      }
      #tutorial-skip-btn {
        background-color: #6c757d;
        border-color: #6c757d;
      }
      #tutorial-skip-btn:hover {
        background-color: #5a6268;
        border-color: #5a6268;
      }

      /* モバイル対応 */
      @media (max-width: 768px) {
        /* ブレークポイントを調整 */
        #left-panel {
          width: calc(100% - 30px); /* 左右15pxマージン */
          left: 15px;
          right: 15px;
          top: 15px;
          max-height: calc(70% - 30px); /* 画面の70%に制限 */
          flex-direction: column;
        }
        #finance-panel {
          width: calc(100% - 30px);
          right: 15px;
          top: auto; /* 上からの位置指定を解除 */
          bottom: 15px; /* 下に配置 */
          text-align: center; /* 中央寄せ */
          padding: 10px;
          font-size: 1em;
        }
        #message-bar {
          bottom: 10px; /* さらに下げる */
          font-size: 0.9em;
          padding: 8px 15px;
        }
        .panel {
          padding: 10px;
        }
        #left-panel > .panel {
          padding: 10px;
        }
        button {
          padding: 8px 12px;
          font-size: 0.9em;
        }
        select {
          padding: 8px;
          font-size: 0.9em;
        }
        .train-item {
          padding: 8px;
        }
        .train-item-details h4 {
          font-size: 1em;
        }
        .train-item-details p {
          font-size: 0.8em;
        }
        .selected-station-item {
          padding: 6px;
          font-size: 0.85em;
        }
        .selected-station-item button {
          padding: 3px 8px;
          font-size: 0.75em;
        }
        #game-speed-control button {
          width: calc(25% - 4px);
          margin-right: 4px;
        }
        #tutorial-modal {
          padding: 20px;
        }
        #tutorial-modal h2 {
          font-size: 1.5em;
        }
        #tutorial-modal p {
          font-size: 1em;
        }
        .tutorial-navigation-buttons button {
          padding: 8px 15px;
          margin: 0 5px;
          font-size: 0.9em;
        }
      }
    </style>
  </head>
  <body>
    <div id="map"></div>

    <div id="left-panel" class="panel">
      <button id="toggle-left-panel" class="panel-toggle-btn">
        <i class="fas fa-chevron-left"></i>
      </button>

      <div id="build-menu" class="panel">
        <h3>建設メニュー</h3>
        <button id="build-ground">
          <i class="fas fa-road"></i> 地上線 ($<span id="cost-ground"></span>/m)
        </button>
        <button id="build-viaduct">
          <i class="fas fa-bridge"></i> 高架線 ($<span id="cost-viaduct"></span
          >/m)
        </button>
        <button id="build-tunnel">
          <i class="fas fa-tunnel"></i> トンネル ($<span id="cost-tunnel"></span
          >/m)
        </button>
        <!-- 駅のコスト表示を基本料金と1mあたりの料金に変更 -->
        <button id="build-station">
          <i class="fas fa-train-station"></i> 駅 (基本 $250,000 + $5,000/m)
        </button>
        <hr />
        <button id="confirm-build" disabled>建設確定</button>
      </div>

      <div id="train-shop" class="panel">
        <h3>列車ショップ</h3>
        <h4>購入可能な列車</h4>
        <div id="train-list">
          <!-- 列車アイテムがここに追加される -->
        </div>
        <button id="buy-train-btn" disabled>
          <i class="fas fa-cart-shopping"></i> 選択した列車を購入
        </button>
        <hr />
        <h4>購入済み列車</h4>
        <div id="bought-trains-list">
          <!-- 購入済み列車アイテムがここに追加される -->
        </div>
        <select
          id="line-select-for-assignment"
          style="
            width: 100%;
            margin-top: 5px;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ccc;
          "
        ></select>
        <button id="assign-train-to-line-btn" disabled>
          <i class="fas fa-share-nodes"></i> 選択した列車を路線に割り当てる
        </button>
      </div>

      <div id="line-builder" class="panel">
        <h3>路線設定</h3>
        <button id="start-line-build">
          <i class="fas fa-route"></i> 路線設定開始
        </button>
        <div id="selected-stations-list">
          <!-- 選択された駅がここに追加される -->
        </div>
        <!-- 路線確定ボタンのコスト表示を基本料金と1mあたりの料金に変更 -->
        <button id="confirm-line-build" disabled>
          <i class="fas fa-check"></i> 路線確定 (基本 $50,000 + $2,500/m)
        </button>
        <button id="cancel-line-build">
          <i class="fas fa-xmark"></i> キャンセル
        </button>
      </div>

      <!-- 解体メニューを追加 -->
      <div id="demolition-menu" class="panel">
        <h3>解体メニュー</h3>
        <button id="demolition-mode-btn">
          <i class="fas fa-hammer"></i> 解体モード
        </button>
        <div
          id="demolition-info"
          style="margin-top: 10px; font-size: 0.9em; color: #555"
        >
          <p>マップ上の線路や駅をクリックして選択してください。</p>
          <p id="selected-demolition-target"></p>
        </div>
        <button id="confirm-demolition" disabled>
          <i class="fas fa-trash-can"></i> 解体確定
        </button>
        <button id="cancel-demolition">
          <i class="fas fa-ban"></i> 解体キャンセル
        </button>
      </div>

      <!-- セーブ/ロードメニューを追加 -->
      <div id="save-load-menu" class="panel">
        <h3>セーブ/ロード</h3>
        <button id="save-game-btn">
          <i class="fas fa-save"></i> ゲームをセーブ (ローカル)
        </button>
        <button id="load-game-btn">
          <i class="fas fa-folder-open"></i> ゲームをロード (ローカル)
        </button>
        <hr />
        <button id="export-save-btn">
          <i class="fas fa-file-export"></i> セーブデータを出力
        </button>
        <textarea
          id="save-data-textarea"
          rows="5"
          placeholder="セーブデータJSONをここに入力/表示"
        ></textarea>
        <button id="import-save-btn">
          <i class="fas fa-file-import"></i> セーブデータを入力
        </button>
      </div>

      <!-- ゲーム速度コントロールを追加 -->
      <div id="game-speed-control" class="panel">
        <h3>ゲーム速度</h3>
        <button data-speed="1" class="speed-btn active">1x</button>
        <button data-speed="2" class="speed-btn">2x</button>
        <button data-speed="4" class="speed-btn">4x</button>
        <button data-speed="8" class="speed-btn">8x</button>
        <button data-speed="10" class="speed-btn">10x</button>
        <button data-speed="20" class="speed-btn">20x</button>
      </div>
    </div>

    <div id="finance-panel" class="panel">
      <p>資産: <span id="assets-display">$0</span></p>
      <p>時間: <span id="game-time-display">0日 00:00</span></p>
    </div>

    <div id="message-bar"></div>

    <!-- ロード中のスピナーオーバーレイ -->
    <div id="loading-overlay" style="display: none">
      <div class="spinner"></div>
      <p id="loading-message">データを読み込み中...</p>
    </div>

    <!-- チュートリアルモーダル -->
    <div id="tutorial-overlay">
      <div id="tutorial-modal">
        <h2 id="tutorial-title"></h2>
        <i id="tutorial-icon" class="tutorial-icon"></i>
        <p id="tutorial-text"></p>
        <div class="tutorial-navigation-buttons">
          <button id="tutorial-prev-btn" disabled>
            <i class="fas fa-chevron-left"></i> 前へ
          </button>
          <button id="tutorial-next-btn">
            <i class="fas fa-chevron-right"></i> 次へ
          </button>
          <button id="tutorial-skip-btn">
            <i class="fas fa-forward"></i> スキップ
          </button>
        </div>
      </div>
    </div>

    <script>
      // ===================================================================
      // ES5互換性対応: ポリフィル相当の定義 (変更なし)
      // ===================================================================

      if (!Array.prototype.find) {
        Array.prototype.find = function (predicate) {
          var list = Object(this);
          var length = list.length >>> 0;
          if (typeof predicate !== "function") {
            throw new TypeError("predicate must be a function");
          }
          for (var i = 0; i < length; i++) {
            var value = list[i];
            if (predicate.call(arguments, value, i, list)) {
              return value;
            }
          }
          return undefined;
        };
      }
      if (!Array.prototype.includes) {
        Array.prototype.includes = function (searchElement /*, fromIndex */) {
          var O = Object(this);
          var len = O.length >>> 0;
          if (len === 0) {
            return false;
          }
          var n =
            arguments.length > 1 && arguments[1] !== undefined
              ? arguments[1]
              : 0;
          var k;
          if (n >= 0) {
            k = n;
          } else {
            k = len - Math.abs(n);
          }
          while (k < len) {
            var element = O[k];
            if (
              element === searchElement ||
              (element !== element && searchElement !== searchElement)
            ) {
              return true;
            }
            k++;
          }
          return false;
        };
      }
      if (!Array.prototype.findIndex) {
        Array.prototype.findIndex = function (predicate) {
          var list = Object(this);
          var length = list.length >>> 0;
          if (typeof predicate !== "function") {
            throw new TypeError("predicate must be a function");
          }
          for (var i = 0; i < length; i++) {
            var value = list[i];
            if (predicate.call(arguments, value, i, list)) {
              return i;
            }
          }
          return -1;
        };
      }
      if (!L.Polyline.prototype.getLatLngs) {
        // For older Leaflet versions if needed
        L.Polyline.prototype.getLatLngs = function () {
          return this._latlngs;
        };
      }
      if (!L.Polyline.prototype.setLatLngs) {
        // For older Leaflet versions if needed
        L.Polyline.prototype.setLatLngs = function (latlngs) {
          this._latlngs = this._convertLatLngs(latlngs);
          return this.redraw();
        };
      }
      if (!("equals" in L.LatLng.prototype)) {
        L.LatLng.prototype.equals = function (otherLatLng, margin) {
          if (!otherLatLng) {
            return false;
          }
          otherLatLng = L.latLng(otherLatLng);
          var margin = Math.max(
            Math.abs(this.lat - otherLatLng.lat),
            Math.abs(this.lng - otherLatLng.lng)
          );
          return margin <= (margin === undefined ? 1.0e-9 : margin);
        };
      }

      // ===================================================================
      // Custom RotatedMarker: 列車車両の回転を可能にするLeafletマーカー
      // ===================================================================
      L.RotatedMarker = L.Marker.extend({
        options: {
          rotation: 0,
        },

        onAdd: function (map) {
          L.Marker.prototype.onAdd.call(this, map);
          this.updateRotation();
        },

        updateRotation: function () {
          if (this._icon) {
            this._icon.style[L.DomUtil.TRANSFORM + "Origin"] = "center center";
            var currentTransform = this._icon.style[L.DomUtil.TRANSFORM];
            var newTransform =
              currentTransform.replace(/rotate\([^)]*\)/g, "").trim() +
              " rotate(" +
              this.options.rotation +
              "deg)";
            this._icon.style[L.DomUtil.TRANSFORM] = newTransform;
          }
        },

        setRotation: function (rotation) {
          this.options.rotation = rotation;
          this.updateRotation();
          return this;
        },

        _setPos: function (pos) {
          L.Marker.prototype._setPos.call(this, pos);
          this.updateRotation();
        },
      });

      L.rotatedMarker = function (latlng, options) {
        return new L.RotatedMarker(latlng, options);
      };

      // ===================================================================
      // CONFIG: ゲームの設定値 (const -> var)
      // ===================================================================
      var CONFIG = {
        initialAssets: 50000000, // 初期資産を増額
        costs: {
          // 各種建設コストを増額
          ground: { perMeter: 50 }, // 1mあたり50ドル
          viaduct: { perMeter: 150 }, // 1mあたり150ドル
          tunnel: { perMeter: 300 }, // 1mあたり300ドル
          station: {
            // 駅のコストは基本料金とプラットフォーム長に応じた費用
            base: 250000, // 基本料金を増額
            perMeter: 5000, // 1メートルあたりの費用を増額
          },
          line: {
            // 路線のコストは基本料金と総距離に応じた費用
            base: 50000, // 基本料金を増額
            perMeter: 2500, // 1メートルあたりの費用を増額
          },
        },
        // revenuePerStationStop: 10000, // 駅に停車するたびに得られる基本収益 (廃止)
        passengerCapacityPerCar: 50, // 1車両あたりの乗客容量
        // ★修正1: 駅で生成される乗客の基本量を15から50に増やしました (コードでは1000に設定)
        basePassengerGeneration: 1000,
        passengerRevenuePerPerson: 100, // 1人あたりの乗客収益（降車時）
        passengerGenerationInterval: 100, // 乗客を生成する間隔 (ms)
        passengerMaxDestinationAttempts: 5, // 乗客の目的地を決定する際の試行回数
        maxWaitingPassengersPerMeterOfPlatform: 2, // プラットフォーム1mあたりの最大待機乗客数
        // ★修正3: 1路線セグメントあたりの最適な車両数を10から5に減らしました
        optimalCarsPerLineSegment: 5,

<<<<<<< HEAD
        // 列車種類を架空のものに修正し、画像設定用のプロパティを追加
trains: [
  {
    id: "shinkansen-hikari",
    name: "新幹線ひかり",
    cars: 16,
    cost: 4800000,
    trainColor: "#007bff",
    defaultSpeed: 285,
    frontCarImage: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKYAAAAbCAYAAAD23PTcAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsEAAA7BAbiRa+0AABq6SURBVHhefZp7rOVXVcfXedxzn/PutDMd2gKlD2WAgFBjNBGIISgEI0ZioyGxkviH0T81GmKMiYl/ER4JqdTIS0AeAkp4BAytRVtK0aGd6fvBdPqaO+3M3Jn7Pvc8/H6+a+/fOVOq65zfb6+91netvfba67d/v9+5t7V8enkcMdZnQi19UlY4nVpjIVLctKlP25ZkQJIkLXjk2acZx0y7Fe1uL+4+cSI+8V/H4snVzWi1t2N7px07nZkYdWejN9iJGHiAaPWrLV0YjWqnGjshEfKZ0RZC3vZwTUyYjMTbdjxKf+JRt3VqSyapxO1Uy9jzwwcA66bGQS4GfizHluVkE1OUaQkLl3piGLVyNPcdmFkRjDwIw9jul3g5NXNu4itYZBaLw8SCCgYrQiZFW7kZ2T/6zC8qz84dHNDYqthKJjsZ0rMQueeFTFg047IWqeSU1EbbyIQpbULUkmPlYb5/NvaeORWt06dPS5KgPGxWJJX7vyjxaZ89c5qEJ6heq9WO4XAc/f5WnL+wEt+/8/b47u3fja21lZjrdD1CO7oxopDED9udWDl0faxcdZ0E8mE5JN5JQVYl4sUSZ5ODGkRCSlEXpfliK4UXlmQjV5+CqUnFJ0yxLC6y5+LW12uYktQIhKosERJhwCbwkhipS2NQNFwyHFqojL3qpuaITglzjBKmuIKnW3HKFX5zPWD0xcxSuoo2q7iQACUPxlR3MOBQMz5azCwGlMQwbeyrqHGdghKNe1YJaz8ibBZfWI7LHz5RC/OlVMLWqZnQ/0c4FyyHUzsaRbvTicFgEKeeORX3P3g8Thw/Fk/89InY6e9EVzsjkxlx6cqEFI+wxlyn8XgYz77l12I02xNuErjBgJQgYy2HEU1AKXJAUzJR7gBTSRNligtUp1JiJusaH0WubsnOJVTtU1UWtdjUHt0quYSIvRFNdHDVS7VPhjZtJjpxJQfIOOedJfU550TXdTIZwzyrNm1qb0JNprIrO2vdrTJxE/YSfA5jC5jSihChLKJdZ5bjsoePZ2FeslO8jG0mPfmXEqrcyNK+rWLrzs7GPff+MP7tW1+PM6eXY2Njzdt0qzMJAEtuJybtHipTnVSeO4M4f8Pr48IrXqWNAbASoLaueYrwA5POqktSVdOXVDgBjKFrJxzg1NF34gVgERiXTO369l47bOU1BvJX5L5lSTZVo7ZPSh1keFUYWMgKNWqdntKHKry6qWa5durlV70CeBl6qWa6X2daZRNcKcKiN5WmBjrRsI7iyiYwTdWfVRzlzmcyfBy7VS8HHis7ZrPOlcBP9a3n1oO8+mr6uv1qh5ubXdTteju+8b1vx+c+84notDoxPz8vmJ7Z7Evpqn7LgGPdR0coB/2InWFsXHlNLB99swKWbDiS+yw1qJm67cTSxRY+T6krsBRTMKUARY1dpXzo1KG2uLLaXU7oUl5ciCpKrQeDTd4j2Zf6/qbMODUTOyDCOja6QsrOPFCbgIUveHeKGxNCnnPQcDBXN6WXR3GTPGOmJ1Hi60XPoMTQkaza5wrQV2zpoPDME9ssA8hqO4QBihddppZJWMfBJ7LkjKcHHP3i86fjIIXJy48NBM4kpFFGUgindcRCPEdsDXfi3NZm/PTFM3HnV78YDx7XFqzb+MzcnALWs6Pgery0rb1R3TpGus0P9XxJO1jYFRe1O24fuEx1QtC8hGT6CDbtclxHgD9PWr0m1sRCjEW0kEcFYycQiyFETlhd9IiLRZqpqQyOk4UmbM1H8jnOpXC7dZtcTbz1qTDlFHRq8p0Khy1ZLmI1LLgqK31js6cNoRQLHR00VioA4kxs9YG+yOlInBwGqUvKPg1mk42u+GjyqC+AqUQUcR3ORN+ycjZpk2K8Xc89FwcedWHyjEk4k1RDjcOmTQcEBXfP6efieydPxbHTz8by+ZU4dOJY7Fldbd5PvPaQnjNDxTrqzUV/9+7oL+6K/p59KkjtsOJHvV60hkMdlHISO6lnIic8aNdFtSg6OobaUFsqer1hSj4jwGJ7qKt9HF0Vtjg9xwopeXc0ED6D4QrMD/NgtLosuZiJ0yOG4lWHC15jkLC0TxtIfV9karUoer3TvNvAkwhfavv0MBpDUGZIi7eOzoyOixE7t/q4N0tPQPp+ORMxz9Z44HHwya8IQDnqzsbBALReJyk5GBMkY401H+LCradDrP6krFLl8UaxtVoaz36wR0pWsIJQpA+9PQiX/R2/oOX4s4qduehsHPPL/Iy0ZswJqY7TL0T/4cdKYcrQ8kKTAetwOstLe6Yddz19Km6971isb/djXbdfdDwrdnZ2YuHUT2P+madjZn1VwWk3nJuP9UNHYv2KwzFaXPLzJ/7GevnxzinXJMCjEaUpxyYoL4YKkzrZUlZG404cbg3jNYsbcf38VtwwtxmHZ3diTknrtgf5TKpJDhQPOy+FGh2VKb61dbc6Gl9x8XLFKOz6rI7nKIwXSv5VzoQgkYocGfYKlGIiO5ybcOnJhpnxWIJPfonA50gXD7nMkh0rLvnFH6SFIh+M4dFkSzhDxcebdD6C5CgeVcGNRsSOToJ2edRxMFlG6ZpYVETgbCnCQD5b7U6MWDLGEdNWHnTTEs+vI4xG8cmv4Fo9zUeFJZu8CHXoSxyOkWxo3qFNZfqXh26XGBlTm4dwlKZfhmVMRCMldNT4Imb1WzPWt4W758lefPLusyrM5bJjCsw0mAwOKg0F7s50477l5+PvfnxXnF7djAUF61gVDGjsmVRbCzKcmYkdjehUSdVWAY+1a3KFjClMbwk6SBwyFsARECuRaiFlPBy2Y0sLu683jF9Z6sfb9m7ETQvnYq6zHdvaXXcGWmhdnxRBpzOvYp+NcZcEt6PX6ekxQcutQphRoN5lpBmPttXqo35bRe4C0pAtJZE5ExmJHMmOuFiYtgqA6PyYY0wuIcnGv1yor7TKkTPHzqI5Gq+J4YddChz5cWaZpgrDC4hcLeVJDF5IwFUBRv3MERcN8Sj/5NLFN46Z0RbZL9YqFm5b+ra1TvwczEAtfglRjrh4uYBao75hjNQa67FKLUYzutMMNDfCHw2UFy5ix8NYxS88F5WCIkQuMpa1pUJU6ZdcyYaiRc2ZK6DVkxQsF44OUDJ0LqTRVhJ3P3o2PvalH9RbeSEnkoaJtOPC9lbcd+ZMfPqBY/HU2sWYV2WzHp6oBneNFWLwTJMvBgdPeBQbuxfynGAa+bZKdYvwwzW4R7venu4wXjHbipv2bMdN+1pxxZzei8Z6Zp3ZFa25PdGZ2x+d3i7t3gsy0s7rq5e4SbbGIXfy65cQxcgtn9sQfEt8GVEHO7IsZeeEi+CYPyf7w0dCy8Hel/Ezw2pJkhvyouTcfTEKnrMWjz9IeC4F+3JuQIAnThWoxJ4T9vgyRh7LODlHRsCGAqFIsyB8KKFsFB68UJV7N5apryvJBFJHj1uMqf7IO6QDMCZfmNBZ5MPzJkesp6AUFpEaxEVYgOAcdyXWnKbE5h1XK4+QOY9Vc3f88P740N9/YVKYLAKLQfK7eoL+96eejK899licXFnRwDixrzzKcMbbOBvICVUAqeGcV7tJjOpIYQ1ja9CJnuK7anYUr1vYiBsX+nH1Qiuu2rUnFndfqQLcF6EC5FbS6i649SKWxUlK/45ILImlZcdNsjBWtMuf1gWGaUe3mquvPBSzPRX1FLkQnaGIbe0U233d6hw4u+FI+G7M6RhKh89Msa5xxTWUbS50RkSEHXW6CmTI87P6zN3pUqej3byvxyDuRimSUN+eFibzhzR9oevqTrDV7wtP5lHorHWakbyrufIHjIzVI8l/J/qKc0djFyc+sa492TgmyXKYXMuB1mxbY+TzbhKY3UtLMdRjmnHp3gne6u9Ev6/nd8FzHsrRTC92LWgTYVzjc212dIdb29hSXUrGVVFi3bNrSckCS4/LdBR33HNffOQfPl9u5cKREAZel9O/uus/4vGz5/SYIKOyyriiQMu1a6oJzD724gzUt7Dcvlq6ijblqq8EHpgZxht3j+KtSytxdH5Fm95C9OYPx8Llr42ZxYNypquWe0z1Wp556OUOIr6eGARirIqhWxji2dFjxJe/+f2474FHXSgzKsjf/PW3xRt//vpcBDtLYj5PPbsct37qi+qpJEisfen2puS+/3feHa/7uWuVB5WeZFjee/9D8fVv3455GVwLRTDK3c3vfVf8wutvFJsXk3dyFc2tn/lKPPnUs54PNvmiMo79e3fHLTf/Vhzcv6f41226Nxu3fvZf4pHHT+a8IPyL2P3++Jab48gVB737W6b5PPTEqbhNNjN6rMo8WaW4h/G+97wz3vyG18pFxoSvU8+/EB//1BfUYbcrYE2EuI9e/+q45ffeGzsq2ty8Iu578PH4/Ne+rYsy84MrKmOgi+2Wm98Tr7vxOl/MgNe2+vGx2z4XF9c2uJYkyzh5zj94YH/8+Z98IPpbW/ZDrLff9ZP46D/+s8s0hTI6LcCf3vGtePTFFwhLNZn7Aknzs6F9luLgUDJcjPr6oZ9P7cuGNzSuxFfPbcWfHTkb33j96fjy0eX44DVr8cuvujYuO/r+OPiGD8Tua38jOotXCE3kKkz58LMaI/kKo49OLKLkfHbjySauKC2yB9lxRQ+GAz07KR4VKg/gyP33WYA+ZCTcyuq6r/A2u5f09YLtams6/sDD/osWY7W0KAMV3yNPPG1/vgDL3Gm5AP77/geFA5/EEOx6p55b9ksCFwq7GESuL2rs8xdXcxqIxfCCdPzBR1QEet3gUFy0xDfYGcTJp58XUDEq35hIG0+efDoxShavH8lrJ1Us9x67X5vB5G7B8+ajT55UXnIXxQO7F+yM5vzgo49rLApcAgHAv7hyQakquyIWWhrGmJud0QX3jHNDUZIHLuiLq2se3y9JZEE68vWs8uDlQiySOEe2Xi1+Vof9+Ju77ogzF9d8G8rMeLUEBogRxaZFkh6MZVo85chYimlXdxTXzQ7infu24i+OnI8v3Xg2PnTDKN525GAsHbopZq59X/Ru+N3oiW+155RcPbjrQRzvvGzw8wzunByNkbcDnqGIt14UxKajxOmdRwdpYhcBjz2Td1xMuMSL1lezKS8kzH3icFISn2Nbqb4e7Cki4+zVvJ/Z4IsLoic3jO+fndTawMQzby4KF3uVUpS545HDnAczQMIiz5RiJB7Lea4GD7b4ae4m3WJLeGgSlvNRKNyubSqsdfJPkWXGwCGmqNKOeJtdVLmGndFFZTw+dTS5gqeYcK7DVuiI3XMs/ktKbJKoFODfL0kZi0qvFX955+3x9IULejfUG1/BmShQ88WBIquqtne1VmypmK7Ts+IfHdqIv77qfHzwFefjD69uxZtffTR2X/P26F719pi9+lejt/96Daw35tGOEsqiKRC8yXUzpvlcHGQuSOuE1MFsCGkaUxAVWBnbuo8dfewk42Bc3wk4Uqsjd4TsJ8Ej4dM8f5FA7HUklVhLywCMUQ8005RjSoY5i1DdICj5xsL2SKmGAk8qs7es5CUtbOMXn3QjEbbZAcvunh0dYhk7l6L6SVXDlCA8X0zV1uJD7Rm7zU/+6pI4eOaKIQ3Y1NYBRKjdFMaki5dBvvrw8Xhi5VxWKW+Gclh/9M1vXr8ZMCdNUDPaGM3GLy3txCdfeT7+9ppz8WsH5+K6a94Sh4/+diy+5t3Ru+yGaC/s11WsV2turPwsI7cZVp5z3uJpS2BZMHCSoyKxyDmsy34BFSpYcbVgrAarNu0Ug7pMjWciOtWDZcLsWpzX89RAz0Sbsb6+GRub2zp24vyF1XjlVVcamB8yEnohmolNPQJtCre1tR2b2/3Y0HFxYyMW52bllFVnvDzY+QaDfqzqhWxNt+4NvRRcuLgZFzVWX48Zc3O6Jzk+kQtjGLPd2VgVbn2TQ/HouQ27tY3NWFpa8FqBz8IY6NntgG+fa459O9aFW9V8zp2/GJcf3C8MP1V5BNlGHNi/V/p1+wO/toGNWsW3mxeUGn1ZvPnZnudKDOvlWNN8Xzy3ongWs3byq7uHTDTntfWNWNWxpmdNxrqoO/Pi/ALKdK2PtzkXmXrLZ54f//43vxqrfd2y/XseCqmyCu2cn2GyUMcxr1f8UWfWvy2+9/JBHD5wOOb2viZGc3tyN9SzXEd+eH9xAaUbzUlJo+s2o86dIDHOE1jLsSiLXyFVP0UguJhqYTd6WgpRbX9nFF/5xnfj/gceUlHM+FnxXe94W/zim45qVfKNkLHTVKvU6sY6Sdfi06/zXpifi71apCH/Kyp0Ruc6jeUXz/otlcvXXz3L8WJw5PDlMS74PJRjySne5RdWtF2xY2mONtNb6p5dk7da4I5LjPydfOY5/9hvvALmWXdpcUEvTLtUu4Pin1j13Ko37xfPX1ARbwpfdze9kc9043K9cAx2dDvXBzQ2beEvrm7EhdVVPROmFDm/XFx1+JAuVL2cNJR2y2fP68LdwLF9M8ZcrxdXH7nCL0oGeVwe0cbyva7Zc3dQllSozGPv0rzyywbBVx+1/3nvA/HhT3w6Wo8+c3L8B9/5pl8KeGHhQ1HxZsyyIdvdjTikK/maxdl4y4GleNPBPbF7aV+0ers0MhVvpFqsX0o5ESe4UIlZJ0dkmsiytScqq1DVEXx2aApGftJNTffEjmekH/3kRNz9o2P+qWhhYSHe8463xhWX7StjJA6LwmoMcdMCE1ezS29KLA8FmlJx+jrGSqlUM7HknD/BFaWpGDWyScY8huU5T8+S3R++4CeeCq64g8+sTPxPsNImXEfGw2aS6KJgjRiDjd+GYNIXxWVuykfDGyvGgImo8VskhlE7YvB754+Ox0cpzOXl58ZffuREHH/hjAbSi42uqqVuLy7TbegKFeOhhfnYNzcXe/Qmt9jrxCxvsnr4Hulti3jt2k49giiDlcjUiC8hbKRplNMWE0LiuVo1na5MNpzPACpQ7QSfIt44N70D8qLWifm5XrG+lGoUlrtTEA1Q2vxK1iy1KRdLUVnpUw3HvSyAiYULwLBpL5dSLbri2qd0UeY4ZeqxaMvY9MA2ptDPMMXBZABTkZbxS46bDUAjlHnkeWKX6MRDze+W8D5D1WoK7a/mpov1B/cej4/c9plonTn93Lg92tCCgeM5MH+Hq385wNwqBkku1yvHE2WnxO2hrLSg9kVeiMJDBaZvk8DsFDlC26eQwJMr4LoybqSfrIy6hSkyQ3SAy1SUotXJYTYAEXxpqmhCU9Jqmz3PwVpkQGoHUpOiMro7TWaqMttKxU8Vpbqe01PpuoHxg41lxdAT85NbYiwrrXahZHV2vqCCdIApzrHc8/llyXnW+OAJQW3OrsRpTmSAudQmJHU6D1V/P9CO+ZHbPqs7tUTDcdd/JfDvfL5FTH7UhuycrxzzTMWuzhjmlXz06Ca4tIIxX/o02PA+wCj2J0GFpA8ob1MuMDMaQy0XDKljvRusHUqW11EeyHX27U4CnnFQMC/IY4PwBMGph096xhe3nhttPcCqtVWeaI0tOJicG6w+SqT9W+bA3U//GNvEfKLyaOT+MEZy0zLPufJeLXE4hvN8+OTE7N+QogdKOrze+jhX6krkxz549/lUDOdC8HTA1ARA4itrvYhaykfJXMfGjgYdeRZT8TStZe2YsDsbL6jHjsiDqfVerKx+WJ1LtUPJ5ZkJ1+0dGbstVxraTJgZQMkXsj6dO7DEYEciil06qc0lLTQtIyUpr2MnwWdfkqk5gM6euCkw65XG0k8ScAnldHUiXiDSGwKP0v0sbFqGrQsLjhaa5qEmPAMxym4TID6m5S+hHCf9JhFDnamdup+aCf2MO0Mzn76gEMg5c8j6KHNjMHjLcpxmlsSqo4YLhNzWl8QqNCue4+7/OREfvu2fKMzn1dU2OtiOtQvP662Rf1tigMl0IBtXZ1VjZUHgtelnYRWNRBMeWDqZ1he301TdQQ0D0Un7SVupGk3JPGO1EmWTdrT0oZRMcKaSTRoT6gy+wUzgiU1HBQNVnEQeT32LChbemcpVbZQVn31EudTW6Zxz4EipQ8VGTBNjJRvU1dAZLGIb6DAcHWzBZQBFlrDspxefJsUwIY/vy5qODumLbXXpMWpSM+iKdPfH9z8UH/8Uf5KUGHC7OxuLuw9JqZ4O3srd6uAWyp/1eOHh1su2zGs+/MvJeRN2a3nq4TmaW4Za/gJjLDK1Vghff5i1T1od2RcEf9ZjL7j9cSTGB3qU1a6Ml31a7ArWfsBLRiYEtl/HypiJYxz01uEPJ9UHMaGFd4JLq0/FVr3zIV85DjL0xbYe5TM9N534Ak5MkXM4L26LjA/9ysus4Wl1MOExf5q1vzpGVkdpHGP29WnGyOOS8cXj3+OTR+TmU6+v/TTznZJP8p1jcVC3fsYs10F0ZuZiae+RmOnN1/K2AxuIwBnJqVQ9Zw3nC0hn8SLgtimDIyvUPLcVPmXZz+Qhw04SrvTsGmM5DVzp17M1fAnAyuID1guf4qIpuhQ4Sdak3nLFkbysncjkfQLvhot3gqOth8MosXjHgYrfpIlP+4IVg79mIyMGMXZTjktpErV9VBC85VMy8xRBYikGkmu1TobQmgeTvnOO07JJi3SSbk7ESq6RZ58lNt5H5RMOwgcd4YgNxp/l5WUjU5RAzsPhTgx3+rHT3/Rtnr8W8MMvO6RRxRlOcJz/3CDSZPnngVywLDNQ/jNWsra1nKqzG2HL/cIN0OwmwePLVaqDr2SGpItCeLqUJjGIFzDHqp0pdJkPlA3xJwSVJbaDSQxzrIEUcaGJvAboOGqwNKpaR6tvOb08gacp/kA6nsbEEgANW5+L/SxaEJXqqrgYLqE0Li5eQthAzh4DZI8xKoOlOz75DMqPF5aINGaVeyT1c00lLQr+8eXWz36JZ8zlhBf9hBKZE0jeECdXFpYnZbCl8EwMm7b8g0B/ey02Vs9Jzg/x0hBs40NHKWL80nCyRqcs6NRVWbXjPHUqrM7FPwLb23YSkxrD9PWpjG4ZgvRvzq3Jsoqkq9aikjjzGsNqZGC5iOFpCqZQLkzh2VqrXv4y04WKjHF9a5WKXsVZ7isNkcFAMlxwUHXnLp2puIqvhtTF1hJSpybnlJSFVgVpNzlXja2yMaU8/xdTbhkPOASs7HXwTz37THz+X78T/wuUV0KHMm9EIwAAAABJRU5ErkJggg==",
    middleCarImage: "data:image/png;base64,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",

  },
  {
    id: "limited-express-sakura",
    name: "特急さくら",
    cars: 8,
    cost: 2500000,
    trainColor: "#d9534f",
    defaultSpeed: 130,
    frontCarImage: "data:image/png;base64,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",
    middleCarImage: "data:image/png;base64,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",
  },
  {
    id: "rapid-greenline",
    name: "快速グリーンライン",
    cars: 10,
    cost: 1500000,
    trainColor: "#5cb85c",
    defaultSpeed: 110,
    frontCarImage: "data:image/png;base64,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",
    middleCarImage: "data:image/png;base64,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",
  },
  {
    id: "commuter-bluebird",
    name: "通勤ブルーバード",
    cars: 6,
    cost: 900000,
    trainColor: "#0d6efd",
    defaultSpeed: 90,
    frontCarImage: "data:image/png;base64,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",
    middleCarImage: "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIEAAAAdCAYAAACNBA9oAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsEAAA7BAbiRa+0AABQPSURBVGhDbZrbr2THVcar+1xm5njG47E9KCgYy0nkTDA4AZ4inpDgAYkHnhAEhQQkRwIhgsRNRMo/gJQHkODPMIqwZawhE9uJbKIQOxAsX8cXEqM4zsVzPfduvt/3rbW7Z2B1V9WqdV+ratfeu8+ZffKvXlzuHixGw2w2H2OpMR39BEsIQQqDArYcy2JFg4k4ZonHbOIHmdmwBcyf9EoHBQYb1ldRRc6KCK3DolUk406AjBGPibMAkZKfRIyIAM+YPh07bOKZhOEWrmGpmPBAjLOO2wATvofYESDniRgta74FioCAmKyMYydvfSPjLiB6ZumnvCS8ikNAjJ6XnNrh4WJ84bfuGLOPPvJVWdkostzZQrSX1goe5aSOiNdiDaZpBbDaFcKRd1c02Ppk1nINWLLCWC4KF23O5mxZJwQPWOFwF+qtoS4xhhd/FF225uQbqvs2hQTKpbtYri6OYf9tAzpK9lRWAOYFJkpOoyVrF0djBeYV1RuIsWpHrOZrmnUp3Q4YerCQVokYUPEmaiOxZrsoLuTngfH8mD342ceXxxtborU5QWTLZk3i3nLs/EleQuEITFqzA+e2zbAS1rQCc02FdhHWddpTsNAiXHL41zBHd3LhKP0JJdQM0ADJaO5Z+V9B6UmA04CxbcUEeM1Lb6kgZhUTHIOFaxTixTAmMI2Ys21raojL8jnVQuC6oz8ZNYSWbk16mnTlEtlKgtnd71/kZNJ3CjwCk1+NRone2UKIZHZpwpncqJhmrzcDSFJ1uvkGxJrNmalRSItiL8qWW5dvrIOsVei1jaeOq2UyhFgxMGUehZWMYZIQKmuOa6IU3KLgDYC9eF615GHGBEarywkHhh+NlYjt4JOCUA/XBD7Tii+igsTSG7IZE/uWRBtnIGbFsBg6GqXdaUdwrcFzEeChnk3jj8e5REhEOAWzGXeRmbACEAupObgkHwiCXVKe9E0Gk6+mqWNsqRUe5i0f6TPyBSbb5Fa59yLXbMKSa0cmqJi7sUG6RYd6aCy7QqwcK5mnWgLRYw55COC0eIuGPtiuFjuCxhGVEatgz0zR8w2h8QLyt5yI89lizDnam9GirZAHI82IkEBNTQljCLol05yJCV6uQIJ1DuocU8l5Q1kssraJnGfIB58WChoy4NjS5kMeb9ENz2DciL/gShbNSBBDlA0Li7V+tebDo8lIYgmxuDFegIoXtpvAF8kkjACTRBJM4NiAXGSTb6iFdu5NyKmzJgfYp3D715hv0US0bXhM8XmsjaDBybHgVfVeLMchGrdMzy0bk1YShWc3B1OyMxFArWNeWhmz2uqeik8z1cQ3r+wLKDywLp9WfTlwaWR45vsrsLJBJK2eojVMRI9OR2rW9ERUTdwidKtZZNbnAqZ+huhJ27+NlreJsmqaOo4Hjeh7w5nEZVI5mba635Izz0FeKY39nGYa9q0kedhRsVYAAnZDmf3aX35FlE0/vULoexIT36oNRKhiWslqCK5m9gJVM+MOzb5sIuIODDYJbpgBD1mYPe9Ql+NowdGKupKbx0DfG6F3rDlZCopmm3W/BVYbid4W9Kk5g2x4AUplsglNA5vawATTxtWjrMap5A0QBl2AeEVe0AEaWKhYZMRGoYJ4S88miNbMSwadOaXA6JLjC4rj0Jdpk4wiT81CdL76LirOpR4FFt99dMweu/jccnsTd0D6mGC2NncyMW2TPNJ3oQBEGMyEULrSWdYG6962pplOkzI1mysO7KIKU2NHwIZcP4qbE1GYLSncSeaUCleZFHslFR3fVoqZDSBOmW9ZRJcKMt5T2EAJ1jQDXDza64pdRnG10XtTk/iIz+AFqEIgL77WD2C/c/ICx/Qt+okyvT8lA60l5xsb458f/6cx+8pTzy43tAliWkzWoAKiOIxRxJAYVJYViYDI2a8dI489cc1EfHarti5qHQiqOPGxBQ7AV+dkbRdaKQi4bubaJObREABlIaUTqQALu9C9Lj98iSN+asmGq8W0TuKMvOhczaaaTa/00C2qGXTUizl0IiMWzU22kBoQP3kHFsBi6JhEgJTXRIHj1Rc15gb0q762lZHfMHAHYI8aLLgVmxgd8ySV0zNz3kY40/FOOZ948rHeBBuoBaR8dHS4elCKrgDFFUCGt6FtfcylDF/Rn9g+obkYONZgdSHHx3VvFoUdSDCHh0cOyDT121tbNQPU64vPo+Pj8eIrL43rN6+bM/elpCaDFBD/i4UWXdQNfviS7XvuPjceevBj49hOiX0+rt24Nl5943XpHKs5wXajZxkthKpyLF8sDWpbm5vjoY9+bJw6eUpzpACNxH58WIug4iu3TcUOb6k4EDnSOJ9v+ocpLyCxCtlU7G9/73vjjbcui7RwvdjcbMBD1f1IthCf+0LD9tG49557x89duOBFxh+sH7//4/HK65fH7v6+7bAJWAvWTKZ02qgOWhayifvF+OWff3ic3DmtueyQhu7JT158fMwuPf3sMkWN4re+8x/jsYtPjpt7uy6I7x+CnAoUR0adFe4CCW2MUydOjEc+9Zlx3wd/xrIWU+Df/8G74+Izl7S5jiz8iYc/Ph668NB49MuPjms3b1j5pIrx2U/9vjaGimtFkTWQ+GMXnxiXnvu6xBSnaHCdrATwTUxkwLoChLx/sDf+4nN/Mu6/72edw5nTp8efffGvx97+oQ0gQzBJZT0XMDH15Wr71U/+yvjNX/8NbS7RS+/UzqnxpX/4+3Hl6hX7PtaCf/6RPx5vv/Pd8eUnHsvmlu4D990/Pv3bvzu2t7ecB7pHRwfj81/8wrhjZ8e+8Tf5RqAngF3OVNeT43O/l7pykl27fn387T/+3djd29NCknnZwF6Z6PXim/Vajg/+1AfG3/zpn0tv18KcBBcv/UueMUp2bGrnX/ra09oAexbCwVynxIbo7PQttW0t1tbWtq6SLdNo2/B1de8dHIxnv/UN2dHudxDaiQr6Gy/8+3jhv74zXr782njp9dfGN194XlfCG+P5F/9zvPH2m+PyW2+Ob377+bG7S3ABxyVgI17XRtnc2PRJQbN/+9701bql0fEpJubInNg+Od770Q/rKqM6M9m5OU6ePKkctseJE2nks725rZixqblsbcvOdvnwyeCTLkBcqsp49fKr44bs7e7vjRs3bozXdMK8+d9vj+vC2RQsFlcrp4R//taXpbh2/cbYkv/Ez7iZ+jqP5LBJHvA1bqiuG8p9/2C/Nk1OxqOjY8WvtUBP9abmrAFzTnbsulbagNg6IV/v/ug9nxaJxNen66OLTleTaCbjRV8fRXLn/QVTC9r3FD8BBxWAZ7HpcbCvjdBXqK2oYyN0Mr6vi0tSBOpFcuOeliO9AVcBRSKbUzwCs3CvAXrtewNXwYZzUC46G8E8pTmXwGRfBFIPyiQ0DLL5wPNgRhwMehJgFOTqVewcycyb5lFd6bmM0uvahh45MMvUpOfrBNCYlQ10vZYiQDSdeWl6oFubq/k5gnuF8JBSizm71IkzEfFIC8YO8V1eDiq0BND+5Nwlrzn3G5tUpqAJFjwC7FAgBZMfzclhrvt3NAN5CdXHiZUPZeBF1pzXrPy4lbj45OEyyUADSBoT3I8pvk+CGicf+qDjAKu1zVB5mFXRtLHtsnh82MzogltXk2Pd6ipdNz/raMFbzr5E4h6fd3kIoQEVYkCIbReBU8UJoadPn275TQXFCFKjtDYbv66nZxI1E+v24Isvr5w2bsRj2Qys4w2xWWbUULAiG2kNRCeAvsdPxhAXbdoA6mzSVcReaFHrcCFVfKZmBPFcHfaAlvdYCVtwAmtaZwLh01xjVcSTaCKgQUJ82Piemsncax5pfa1vZi0EYpZLPL0wZtq0lSYwWvoNzbbv5t2m06X24C76LZ6HS4F4ed7z7YB3cyZJrmxoVFhMxGIsVTGShJMtafeamjYteGlA8i1AkEtqjQUTTH6lt4pj1QPwPJaie8kyGoetuU/aBuFToTXy5uLYoOuzyvQ2kIr11nSBhB6dXDT6TDL+VpyKskw3G+jY+g9G6/n9X2jFFd+YyeVMHbTeDJEsnAkBW65sVMy5jaiZJxBdpFZiZyzGkYyGb5a+dFDyRrzklx8JR6YDMak6XldsW00MNR5cDNOuii2oTgJZH536+HLSKD1YnCKb/I6hyXosdlWDn7yFcSvqwwS7zktAmht6HeIJn8hDtobHHgy4Z/AYoheXr5oXU40HOQtaXZ0cw88GigwPiBDz+wPPPaKTp2jWyc4KWE0f8gSnlT3XhFvARmL3EiAgsE9jAuHmU4gi2o9BtzbZ4bWVKhCD6yE78xwtEfMOt3dmdMG7XInZmJ0xN0l9bGhxdf+CZ1AWfFwY8bqo7S9DsuD5YeH3dyaR8SbSBJ4/q/M+LaoGx418FdaFNlq6iqU3CLCKMd2Ut4fiFikH/wpWT/v6SJQ1QmayrXksQKj8QRU/z0H+zaTYjG4ouIsmQ3ISghw10NOoq4h/y8FgSI6MlKh/3ErdTXazSpkHnKc2FHsq5iTEzn3wQx/Wq9rNBIqypd2DBFeDQiq2W0+cB3o4OnP6jDdCNNQrCV7LeHfmzeHAbw9j3H323Ng/3PfvAgdq2NzeOtFrKJAQ6nq4O3XqlCm8PXBa8bbBqxsPY8d60FrwylSvTdg7lI9dvVZ+4N7z0z0Q+bvuvHPs78un9A4ODxwTuJvs8COZf7DBhmjokk8/UWPJTTHceeaMXon31fbGzd29cV6+Tup9nhh29/ZN41WTXKObOO46e3acPnlKcew5BvtklM/GoacpLupzdOA3qbYBfurUjut5RNzH6Go8TE2Cx55H8bFz/p7zzovNYVuM2jCzp/ixiKPNDnhNW45XXn9lfPvll8ZP3r+iRdvLe6/4xxJhc/DXrB29X2OMX8YWCpbVO7Vzx3jkdz7td3Rb87+t5de8l19/dewpEPboR+5/YJy+487x7nvfH2+8/Y6Smo9zZ8+MCx+54EVI5ZIwt4ObWtCn/u3ZceXqVax5s2zOVWAd8fxAtaGjUqH4SX5HvnkdPX/PufEh+VG4NsfrK/r8XsGtARr74+AgT/UHWlCOyy1tOl9N6k/v7IxfevgXXXT+FcthAdoUN65fHT+5ctWvovymcO7c3ezS8e4Pf6DFUQ7S/+nz5/Uuv2N5YqSGHMHXdm8o77e8Ufb2d33lIs9RzZsHjhaLbE5+Z7jrrjPj4QsPc0fwwrFG125cHe/8zzvjyo3r3uDkf3zUlyW1qxNZ63Ksjbm1uT0+8QsfH2fPnHUcvBGQ91PPXByzf33quaUf3OTYhTnCgK7K7S05FV1J5oUuRrm3LTTtoxlpqHy4Im8oKaR9H0WDQcU5VJSgemmzTZnzT7ozRTPXTc63IhXLB5pEkOYCJDmc8Vq5KRnqxY836KLHEy40NP0rg3g2IB/5CCoWYs7fFDCqvKTYZxYxL6XjY9cLrggUAJsWfaz2KeWfoqkgvv1+xRO2LEiADW8VLBKX6NYVPv1dRLc9iJ5KLg+tWdwo41uoZByXJrpSReMCpCjwyFY560LjthFb4it/m7P/xGBT3iiiisZm57liqQ32ta9rE/zRl76q3PskYDH4oUWKdkaJWA4Cmyv5Ko7m+zp6KJENEoRECHbBgmJN6nT+nd6JyharEFMadEpQQH8lQbBOBnsmC/CX0e/KWNZ3oSMJU66QIBy8YJxilR27K0terBh2rQHHmonzVGBHxfS7vLnETUnb0tDDs7oKx2k6LBGhC7ckX9lz/JalNrHBiLw3mQjg0LMB0bMZddBZOMxVDLLTF4M1VReXAZp0/Sd66W3wH0N2rqkMUA/n5NHiln/38qUxu/8PnlnOlgcWbnBi/gCupKAXBCyJYASiiy+gX3hnRib/6ADEo2kIefE9C49kNffiaUyCAuw0DlgNO0k4rCCOVl+iR988zwPwTSuDsuAeQ+2PuCdomprJrlpTWFWAOFZKtjkFzKjGMImA0OK9gZnzsWpstpUVRCDabdSaa7K3OBPqqljC4U+xeuJx58rTY/bhP7ykzaXjydBGYyxKay6pUlUs5oOnD2u9kI36qlzN9BFeV0f8mVxOaoxU9UaKH6TzWS/IamyshUTzqeaJWriNNVjTrLW4BP6VsvK2KSvFhgGC0dhcwS1W9BXem7io0UWm6Rn50nlDmL2yFelgtrQi9LBOKtAMQvnHHjf4O/PfxhEllpJh5i/CNkYHWCCtebeAdVfyFlXnRET0HEfCLKM2WSndHknOCTYfMBoadj2d1G+VjZ8A/n0/VrqRKK/ta7IhpBgMk4WpAEJFZDblU7ITrE1u46BEp9aO9S3nuVAgQRTChLrBdN/+wopa2SE+z1umepPNmOY55wXcioxwO/GNswUoljkZ1exGnckIFYEhv+MLSidDycQgQkyCCzztBXJFC18DKCtqy6ZNy9MC/ZzR9GakAkFplkncLZP4RWuV1jWUsmCFBZCf6gSuse1PxgT2O7X+IK9RCHiDS1H4FIYJK5vupdjkLnFkMjJ0n68Z0qlxTSe/5Pp5TO+N2g3T/aKyQtZXcClD8BUF3iRVIol7ZhoTYy3rQweZ8sE3jPAL//8AC7BXzUFkMlHVQ3YOE8Wt9kdaGIZE7aXwbB1sg2Z+dIFpr3q0gL7qJGQ7U3UzImbRkmkwTfPUAgsZw+u5pxN9HfxwvRK4ZaTHFQ0885KpizFrCBVcJL1qzxfHFWENHsuKSeqcnzWYlFFBMJiW9AgtR2/PClCt0Tj2ip1F7Oltxachb3wlFYDaUEICS0hpWhdsriZlgXl8QZjCuUWvpQqZRslwESGrT8e/kk6ZPZWMbZe+ScXqvh3aGvhUY0sHFaxj3i4YNTFH/Irf4C3lMTYr3zXYP9gY/wtK/cCK6jbOcgAAAABJRU5ErkJggg==",
  },
  {
    id: "sightseeing-fuji",
    name: "観光特急ふじ",
    cars: 7,
    cost: 2000000,
    trainColor: "#f39c12",
    defaultSpeed: 120,
    frontCarImage: "data:image/png;base64,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",
    middleCarImage: "data:image/png;base64,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",
  },
],
=======
        // 列車種類を実在のものに修正
        trains: [
          {
            id: "e233",
            name: "E233系通勤電車",

            cars: 10,
            cost: 1000000,
            color: "#007bff",
            defaultSpeed: 100,
          },
          {
            id: "e259",
            name: "E259系成田エクスプレス",
            cars: 6,
            cost: 1500000,
            color: "#d9534f",
            defaultSpeed: 130,
          },
          {
            id: "n700s",
            name: "N700S系新幹線",
            cars: 16,
            cost: 5000000,
            color: "#5cb85c",
            defaultSpeed: 285,
          },
          {
            id: "485",
            name: "485系特急電車",
            cars: 8,
            cost: 2000000,
            color: "#f0ad4e",
            defaultSpeed: 120,
          },
          {
            id: "kiha40",
            name: "キハ40系気動車",
            cars: 4,
            cost: 800000,
            color: "#6f42c1",
            defaultSpeed: 95,
          },
          {
            id: "e6",
            name: "E6系スーパーこまち",
            cars: 7,
            cost: 3000000,
            color: "#d63384",
            defaultSpeed: 320,
          },
          {
            id: "h5",
            name: "H5系北海道新幹線",
            cars: 10,
            cost: 4000000,
            color: "#20c997",
            defaultSpeed: 260,
          },
          {
            id: "shinkansen-e7",
            name: "E7系北陸新幹線",
            cars: 12,
            cost: 4500000,
            color: "#6610f2",
            defaultSpeed: 275,
          },
          {
            id: "shinkansen-e3",
            name: "E3系つばさ",
            cars: 7,
            cost: 2800000,
            color: "#fd7e14",
            defaultSpeed: 275,
          },
          {
            id: "sunrise",
            name: "寝台特急サンライズ瀬戸・出雲",
            cars: 14,
            cost: 3500000,
            color: "#20c997",
            defaultSpeed: 110,
          },
          {
            id: "torokko",
            name: "嵯峨野トロッコ列車",
            cars: 5,
            cost: 1200000,
            color: "#ffc107",
            defaultSpeed: 50,
          },
          {
            id: "local",
            name: "地方普通列車",
            cars: 3,
            cost: 500000,
            color: "#6c757d",
            defaultSpeed: 80,
          },
        ],
>>>>>>> 7758c9bfa2fa1baa0af77b0893d5a199414fe89e

        trainCarDimensionsMeters: {
          // 車両のサイズ (メートル)
          length: 20, // 車両の進行方向の長さ
          width: 3, // 車両の幅
        },
        lineColors: [
          "#FF0000",
          "#0000FF",
          "#00FF00",
          "#FFFF00",
          "#00FFFF",
          "#FF00FF",
          "#FF8C00",
          "#8A2BE2",
        ], // 路線に割り当てる色
        trainStopDuration: 5000, // 駅での停車時間 (ms) - 乗降時間を考慮して延長
        updateInterval: 50, // 列車の位置更新間隔 (ms)
        snapThresholdPixels: 15, // スナップ判定のピクセル距離
        snapThresholdMeters: 20, // 線路接続判定のメートル距離
        gameTimeInterval: 1000, // ゲーム内時間更新間隔 (ms)
        gameTimeScale: 60, // リアル1秒がゲーム内60秒に相当
      };

      // --- GAME STATE: ゲームの現在の状態を保持するオブジェクト (let -> var) ---
      var state = {
        assets: CONFIG.initialAssets, // 現在の資産
        tracks: [], // 建設済みの線路オブジェクトの配列
        stations: [], // 建設済みの駅オブジェクトの配列
        lines: [], // 確定した路線オブジェクトの配列
        trains: [], // 購入済み列車オブジェクトの配列
        planning: {
          // 線路・駅建設モードの状態
          type: null, // 'ground', 'viaduct', 'tunnel'
          points: [], // 建設中の点の配列 (LatLng)
          ghost: null, // 建設中の仮ポリライン/マーカー (Leaflet Layer)
          costTooltip: null, // 建設コスト表示ツールチップ
        },
        lineBuildingMode: false, // 路線設定モードかどうか
        selectedStationsForLine: [], // 路線設定中に選択された駅のIDリスト
        currentLineGhost: null, // 路線設定中の仮ポリライン (Leaflet Layer)
        selectedTrainToBuyId: null, // ショップで選択中の列車ID
        currentLineColorIndex: 0, // 次の路線に割り当てる色のインデックス
        selectedTrainToAssignId: null, // 路線に割り当てるために選択中の列車ID
        demolitionMode: false, // 解体モードかどうか
        selectedForDemolition: null, // 解体モードで選択されたオブジェクト { type: 'track'|'station', id: string }
        gameSpeedMultiplier: 1, // 新規追加: ゲーム速度倍率
        trainUpdateIntervalId: null, // 新規追加: 列車の更新setInterval ID
        passengerGenerationIntervalId: null, // 新規追加: 乗客生成setInterval ID
        gameTime: 0, // 新規追加: ゲーム内時間 (ミリ秒)
        gameTimeIntervalId: null,
      };

      // --- MAP: Leafletマップの初期化 ---
      var map = L.map("map", { preferCanvas: true }).setView(
        [36.2048, 138.2529],
        7
      ); // 日本の中心付近を初期表示、ズームレベル7
      L.tileLayer(
        "https://{s}.basemaps.cartocdn.com/rastertiles/voyager_nolabels/{z}/{x}/{y}{r.png}",
        {
          attribution: "&copy; CARTO",
          maxZoom: 19,
        }
      ).addTo(map);

      // --- UI ELEMENTS: UI要素への参照とUI操作関数 ---
      var ui = {
        assetsDisplay: document.getElementById("assets-display"),
        gameTimeDisplay: document.getElementById("game-time-display"), // 新規追加
        messageBar: document.getElementById("message-bar"),
        buildButtons: document.querySelectorAll(
          "#build-menu button:not(#confirm-build)"
        ),
        confirmBuildButton: document.getElementById("confirm-build"),
        trainListDiv: document.getElementById("train-list"),
        buyTrainButton: document.getElementById("buy-train-btn"),
        startLineBuildButton: document.getElementById("start-line-build"),
        selectedStationsListDiv: document.getElementById(
          "selected-stations-list"
        ),
        confirmLineBuildButton: document.getElementById("confirm-line-build"),
        cancelLineBuildButton: document.getElementById("cancel-line-build"),
        boughtTrainsListDiv: document.getElementById("bought-trains-list"),
        assignTrainToLineButton: document.getElementById(
          "assign-train-to-line-btn"
        ),
        lineSelectForAssignment: document.getElementById(
          "line-select-for-assignment"
        ),
        demolitionModeButton: document.getElementById("demolition-mode-btn"),
        selectedDemolitionTargetDisplay: document.getElementById(
          "selected-demolition-target"
        ),
        confirmDemolitionButton: document.getElementById("confirm-demolition"),
        cancelDemolitionButton: document.getElementById("cancel-demolition"),
        saveGameButton: document.getElementById("save-game-btn"),
        loadGameButton: document.getElementById("load-game-btn"),
        costGround: document.getElementById("cost-ground"),
        costViaduct: document.getElementById("cost-viaduct"),
        costTunnel: document.getElementById("cost-tunnel"),
        // 新しいUI要素への参照
        exportSaveButton: document.getElementById("export-save-btn"),
        importSaveButton: document.getElementById("import-save-btn"),
        saveDataTextarea: document.getElementById("save-data-textarea"),
        loadingOverlay: document.getElementById("loading-overlay"), // 新規追加
        loadingMessage: document.getElementById("loading-message"), // 新規追加
        toggleLeftPanelButton: document.getElementById("toggle-left-panel"), // 新規追加

        /**
         * ユーザーにメッセージを表示する。
         * @param {string} msg - 表示するメッセージ。
         * @param {string} [type='info'] - メッセージのタイプ ('info', 'success', 'warning', 'error')。
         * @param {boolean} [persistent=false] - メッセージを永続的に表示するかどうか。
         * @param {number} [duration=3000] - メッセージを表示する時間 (ミリ秒)。
         */
        showMessage: function (msg, type, persistent, duration) {
          if (type === undefined) type = "info";
          if (persistent === undefined) persistent = false;
          if (duration === undefined) duration = 3000;

          this.messageBar.textContent = msg;
          this.messageBar.className = "message-bar " + type; // クラスを更新
          this.messageBar.style.opacity = 1;
          if (!persistent) {
            clearTimeout(this.messageBar.hideTimeout); // 既存のタイマーをクリア
            this.messageBar.hideTimeout = setTimeout(function () {
              ui.messageBar.style.opacity = 0;
            }, duration);
          }
        },

        /** 資産表示を更新する。 */
        updateFinance: function () {
          this.assetsDisplay.textContent =
            "$" + Math.floor(state.assets).toLocaleString();
        },

        /** ゲーム時間表示を更新する。 */
        updateGameTimeDisplay: function () {
          var totalMinutes = Math.floor(state.gameTime / 60000); // ミリ秒から分へ
          var days = Math.floor(totalMinutes / (24 * 60));
          var hours = Math.floor((totalMinutes % (24 * 60)) / 60);
          var minutes = totalMinutes % 60;
          this.gameTimeDisplay.textContent =
            days +
            "日 " +
            String(hours).padStart(2, "0") +
            ":" +
            String(minutes).padStart(2, "0");
        },

        /** 列車ショップのUIを更新する。 */
        renderTrainShop: function () {
          var self = this;

          // 購入可能な列車リストの更新
          this.trainListDiv.innerHTML = "";
          var i, trainConfig;
          for (i = 0; i < CONFIG.trains.length; i++) {
            trainConfig = CONFIG.trains[i];
            var trainItem = document.createElement("div");
            trainItem.className = self.trainItemClass(trainConfig.id, "buy");
            trainItem.dataset.trainId = trainConfig.id;
            trainItem.innerHTML =
              '<i class="fas fa-train"></i>' + // 列車アイコンを追加
              '<div class="train-item-details">' +
              "<h4>" +
              trainConfig.name +
              "</h4>" +
              "<p>" +
              trainConfig.cars +
              "両 - $" +
              trainConfig.cost.toLocaleString() +
              "</p>" +
              "</div>";

            trainItem.onclick = function () {
              selectTrainToBuy(this.dataset.trainId);
            };
            this.trainListDiv.appendChild(trainItem);
          }

          var selectedTrainCost = state.selectedTrainToBuyId
            ? CONFIG.trains.find(function (t) {
                return t.id === state.selectedTrainToBuyId;
              }).cost
            : null;

          this.buyTrainButton.disabled =
            !state.selectedTrainToBuyId || state.assets < selectedTrainCost;
          this.buyTrainButton.textContent = state.selectedTrainToBuyId
            ? "選択した列車を購入 ($" +
              (selectedTrainCost ? selectedTrainCost.toLocaleString() : "0") +
              ")"
            : "選択した列車を購入";

          // 購入済み列車リストの更新
          this.boughtTrainsListDiv.innerHTML = "";
          if (state.trains.length === 0) {
            this.boughtTrainsListDiv.innerHTML =
              '<p style="text-align:center; color:#999; font-size:0.9em;">購入済みの列車はありません。</p>';
          }

          for (i = 0; i < state.trains.length; i++) {
            var train = state.trains[i];
            var trainItem = document.createElement("div");
            trainItem.className = self.trainItemClass(train.id, "assign");
            trainItem.dataset.trainId = train.id;
            var assignedLine = train.currentLineId
              ? getLineById(train.currentLineId)
              : null;
            trainItem.innerHTML =
              '<i class="fas fa-train"></i>' + // 列車アイコンを追加
              '<div class="train-item-details">' +
              "<h4>" +
              train.name +
              "</h4>" +
              "<p>" +
              (assignedLine ? "路線: " + assignedLine.name : "未割り当て") +
              "</p>" +
              // 乗客数と最大容量を追加
              "<p>乗客: " +
              train.currentPassengers.length +
              "/" +
              train.maxCapacity +
              "人</p>" +
              "</div>";

            trainItem.onclick = function () {
              selectTrainToAssign(this.dataset.trainId);
            };
            this.boughtTrainsListDiv.appendChild(trainItem);
          }

          // 割り当て用路線選択ドロップダウンの更新
          this.lineSelectForAssignment.innerHTML =
            '<option value="">路線を選択...</option>';
          var line;
          for (i = 0; i < state.lines.length; i++) {
            line = state.lines[i];
            var option = document.createElement("option");
            option.value = line.id;
            option.textContent = line.name;
            this.lineSelectForAssignment.appendChild(option);
          }

          // 現在選択されている路線があればそれを選択状態にする
          if (state.selectedTrainToAssignId) {
            var selectedTrain = state.trains.find(function (t) {
              return t.id === state.selectedTrainToAssignId;
            });
            if (selectedTrain && selectedTrain.currentLineId) {
              this.lineSelectForAssignment.value = selectedTrain.currentLineId;
            } else {
              this.lineSelectForAssignment.value = "";
            }
          } else {
            this.lineSelectForAssignment.value = "";
          }

          this.assignTrainToLineButton.disabled =
            !state.selectedTrainToAssignId ||
            !this.lineSelectForAssignment.value;
        },

        trainItemClass: function (id, type) {
          var baseClass = "train-item";
          if (type === "buy" && state.selectedTrainToBuyId === id)
            baseClass += " selected";
          if (type === "assign" && state.selectedTrainToAssignId === id)
            baseClass += " selected";
          return baseClass;
        },

        /** 路線設定モードで選択された駅リストを更新する。 */
        updateSelectedStationsForLine: function () {
          var self = this;
          this.selectedStationsListDiv.innerHTML = "";
          if (state.selectedStationsForLine.length === 0) {
            this.selectedStationsListDiv.innerHTML =
              '<p style="text-align:center; color:#999; font-size:0.9em;">駅を選択してください</p>';
          }

          for (var i = 0; i < state.selectedStationsForLine.length; i++) {
            var stationId = state.selectedStationsForLine[i];
            var station = getStationById(stationId);
            if (station) {
              var item = document.createElement("div");
              item.className = "selected-station-item";
              item.innerHTML =
                "<span>" +
                (i + 1) +
                ".</span> " +
                station.name +
                ' <button data-station-id="' +
                stationId +
                '"><i class="fas fa-xmark"></i> 削除</button>';

              item.querySelector("button").onclick = function (e) {
                e.stopPropagation(); // 親要素のクリックイベントが発火しないように
                removeStationFromLineBuilding(this.dataset.stationId);
              };
              this.selectedStationsListDiv.appendChild(item);
            }
          }

          // 路線確定ボタンのテキストと有効/無効状態を動的に更新
          var potentialLineLength = 0;
          var pathFound = true;
          if (state.selectedStationsForLine.length >= 2) {
            for (var j = 0; j < state.selectedStationsForLine.length - 1; j++) {
              var startStation = getStationById(
                state.selectedStationsForLine[j]
              );
              var endStation = getStationById(
                state.selectedStationsForLine[j + 1]
              );
              if (startStation && endStation) {
                var segmentPath = findPathBetweenStations_GraphSearch(
                  startStation.latlng,
                  endStation.latlng
                );
                if (segmentPath) {
                  potentialLineLength += calculatePathDistance(segmentPath);
                } else {
                  pathFound = false;
                  break;
                }
              }
            }
          }
          var potentialLineCost =
            CONFIG.costs.line.base +
            CONFIG.costs.line.perMeter * potentialLineLength;

          this.confirmLineBuildButton.disabled =
            state.selectedStationsForLine.length < 2 ||
            state.assets < potentialLineCost ||
            !pathFound;
          this.confirmLineBuildButton.textContent =
            "路線確定 ($" + Math.round(potentialLineCost).toLocaleString() + ")";
        },

        /** 建設メニューのボタンのアクティブ状態を設定する。 */
        setBuildModeActive: function (type) {
          var i, btn;
          for (i = 0; i < this.buildButtons.length; i++) {
            btn = this.buildButtons[i];
            if (btn.id === "build-" + type) {
              btn.classList.add("active");
            } else {
              btn.classList.remove("active");
            }
          }
          // 建設確定ボタンは、点を配置するまで無効
          this.confirmBuildButton.disabled = true;
          this.confirmBuildButton.textContent = "建設確定";
        },

        /** 建設メニューのボタンのアクティブ状態をリセットする。 */
        resetBuildModeActive: function () {
          var i, btn;
          for (i = 0; i < this.buildButtons.length; i++) {
            btn = this.buildButtons[i];
            btn.classList.remove("active");
          }
          this.confirmBuildButton.disabled = true;
          this.confirmBuildButton.textContent = "建設確定";
        },

        /** 路線設定関連UIの表示/非表示を切り替える。 */
        setLineBuildModeActive: function (active) {
          if (active) {
            this.startLineBuildButton.classList.add("active");
            this.confirmLineBuildButton.style.display = "flex"; // flexに変更
            this.cancelLineBuildButton.style.display = "flex"; // flexに変更
            this.selectedStationsListDiv.style.display = "block";
          } else {
            this.startLineBuildButton.classList.remove("active");
            this.confirmLineBuildButton.style.display = "none";
            this.cancelLineBuildButton.style.display = "none";
            this.selectedStationsListDiv.style.display = "none";
          }
        },

        /** 解体モード関連UIの表示/非表示を切り替える。 */
        setDemolitionModeActive: function (active) {
          if (active) {
            this.demolitionModeButton.classList.add("active");
            this.confirmDemolitionButton.style.display = "flex"; // flexに変更
            this.cancelDemolitionButton.style.display = "flex"; // flexに変更
            this.selectedDemolitionTargetDisplay.style.display = "block";
          } else {
            this.demolitionModeButton.classList.remove("active");
            this.confirmDemolitionButton.style.display = "none";
            this.cancelDemolitionButton.style.display = "none";
            this.selectedDemolitionTargetDisplay.style.display = "none";
            this.selectedDemolitionTargetDisplay.textContent = ""; // 表示をクリア
          }
          this.confirmDemolitionButton.disabled = !state.selectedForDemolition;
        },

        /** ロードオーバーレイの表示/非表示 */
        showLoadingOverlay: function (message) {
          this.loadingMessage.textContent = message || "データを読み込み中...";
          this.loadingOverlay.style.display = "flex";
          // opacityをtransitionさせるために少し遅延させる
          setTimeout(function () {
            ui.loadingOverlay.style.opacity = 1;
          }, 10);
        },

        hideLoadingOverlay: function () {
          this.loadingOverlay.style.opacity = 0;
          setTimeout(function () {
            ui.loadingOverlay.style.display = "none";
          }, 300); // transitionの時間と合わせる
        },
      };

      // --- INITIAL LOAD ---
      ui.updateFinance();
      ui.updateGameTimeDisplay();
      ui.renderTrainShop();
      ui.setLineBuildModeActive(false); // 初期は非表示
      ui.setDemolitionModeActive(false); // 初期は非表示
      ui.costGround.textContent = CONFIG.costs.ground.perMeter;
      ui.costViaduct.textContent = CONFIG.costs.viaduct.perMeter;
      ui.costTunnel.textContent = CONFIG.costs.tunnel.perMeter;

      // --- HELPER FUNCTIONS: 汎用ユーティリティ関数 ---

      /** ユニークなIDを生成する。 */
      function generateUniqueId() {
        return "_" + Math.random().toString(36).substr(2, 9);
      }

      /** IDに基づいて駅オブジェクトを検索する。 */
      function getStationById(id) {
        var i;
        for (i = 0; i < state.stations.length; i++) {
          if (state.stations[i].id === id) {
            return state.stations[i];
          }
        }
        return undefined;
      }

      /** IDに基づいて路線オブジェクトを検索する。 */
      function getLineById(id) {
        var i;
        for (i = 0; i < state.lines.length; i++) {
          if (state.lines[i].id === id) {
            return state.lines[i];
          }
        }
        return undefined;
      }

      /** IDに基づいて線路オブジェクトを検索する。 */
      function getTrackById(id) {
        var i;
        for (i = 0; i < state.tracks.length; i++) {
          if (state.tracks[i].id === id) {
            return state.tracks[i];
          }
        }
        return undefined;
      }

      /**
       * パス(LatLng配列)上の始点からの指定された距離にある点と、その点での進行方向を計算する。
       * @param {L.LatLng[]} latlngs - パスを構成するLatLngの配列。
       * @param {number} distance - パスの始点からの距離(メートル)。
       * @returns {{latlng: L.LatLng, heading: number}|null} - 緯度経度と進行方向(度)。パスの範囲外の場合はnull。
       */
      function getPointAtDistance(latlngs, distance) {
        if (!latlngs || latlngs.length < 2) {
          return null;
        }
        var currentDist = 0;
        for (var i = 0; i < latlngs.length - 1; i++) {
          var p1 = latlngs[i];
          var p2 = latlngs[i + 1];
          var segmentDist = p1.distanceTo(p2);
          if (currentDist + segmentDist >= distance) {
            var distIntoSegment = distance - currentDist;
            var ratio = segmentDist === 0 ? 0 : distIntoSegment / segmentDist;
            var lat = p1.lat + (p2.lat - p1.lat) * ratio;
            var lng = p1.lng + (p2.lng - p1.lng) * ratio;
            return {
              latlng: L.latLng(lat, lng),
              heading: getHeading(p1, p2),
            };
          }
          currentDist += segmentDist;
        }
        // 距離がパスの全長を超える場合は、最後の点を返す
        var lastP1 = latlngs[latlngs.length - 2];
        var lastP2 = latlngs[latlngs.length - 1];
        return {
          latlng: lastP2,
          heading: getHeading(lastP1, lastP2),
        };
      }

      /**
       * LatLngの配列で構成されるパス上の指定された進行度におけるLatLngと進行方向を計算する。
       * @param {L.LatLng[]} latlngs - パスを構成するLatLngの配列。
       * @param {number} progress - 0.0から1.0までの進行度。
       * @returns {{latlng: L.LatLng, heading: number}} - 緯度経度と進行方向（度）。
       */
      function getLatLngAtProgressOnPath(latlngs, progress) {
        if (!latlngs || latlngs.length < 2) {
          return { latlng: latlngs ? latlngs[0] : L.latLng(0, 0), heading: 0 };
        }

        var totalLength = 0;
        var segmentLengths = [];
        var i;
        for (i = 0; i < latlngs.length - 1; i++) {
          var segmentLength = latlngs[i].distanceTo(latlngs[i + 1]);
          segmentLengths.push(segmentLength);
          totalLength += segmentLength;
        }

        if (totalLength === 0) {
          return { latlng: latlngs[0], heading: 0 };
        }

        var targetDistance = totalLength * progress;

        // getPointAtDistance を再利用
        return getPointAtDistance(latlngs, targetDistance);
      }

      /**
       * 2点間の進行方向（角度）を計算する。
       * @param {L.LatLng} p1 - 始点。
       * @param {L.LatLng} p2 - 終点。
       * @returns {number} - 進行方向（度、北を0度として時計回り）。
       */
      function getHeading(p1, p2) {
        var toRad = Math.PI / 180;
        var toDeg = 180 / Math.PI;

        var lat1 = p1.lat * toRad;
        var lon1 = p1.lng * toRad;
        var lat2 = p2.lat * toRad;
        var lon2 = p2.lng * toRad;

        var dLon = lon2 - lon1;

        var y = Math.sin(dLon) * Math.cos(lat2);
        var x =
          Math.cos(lat1) * Math.sin(lat2) -
          Math.sin(lat1) * Math.cos(lat2) * Math.cos(dLon);

        var bearing = Math.atan2(y, x) * toDeg;
        bearing = (bearing + 360) % 360; // 0-360度の範囲に変換
        return bearing;
      }

      /**
       * メートル単位の長さを現在の地図のズームレベルと緯度に基づいてピクセルに変換する。
       * @param {number} meters - メートル単位の長さ。
       * @param {L.LatLng} latlng - 変換を行う緯度経度。
       * @returns {number} - ピクセル単位の長さ。
       */
      function metersToPixels(meters, latlng) {
        var point1 = map.latLngToLayerPoint(latlng);
        var metersPerDegreeLng =
          111320 * Math.cos((latlng.lat * Math.PI) / 180);
        var latlng2 = L.latLng(
          latlng.lat,
          latlng.lng + meters / metersPerDegreeLng
        );
        var point2 = map.latLngToLayerPoint(latlng2);
        return point1.distanceTo(point2);
      }

      /**
       * パス (LatLngの配列) の総距離をメートルで計算する。
       * @param {L.LatLng[]} pathLatLngs - パスを構成するLatLngの配列。
       * @returns {number} - パスの総距離 (メートル)。
       */
      function calculatePathDistance(pathLatLngs) {
        var distance = 0;
        var i;
        for (i = 0; i < pathLatLngs.length - 1; i++) {
          distance += pathLatLngs[i].distanceTo(pathLatLngs[i + 1]);
        }
        return distance;
      }
      /**
       * 緯度経度に基づいて駅オブジェクトを検索する（中心座標で比較）。
       * @param {L.LatLng} latlng - 検索する緯度経度。
       * @returns {object|null} - 見つかった駅オブジェクト、またはnull。
       */
      function findStationByLatLng(latlng) {
        for (var i = 0; i < state.stations.length; i++) {
          // L.LatLng.equals() を使って座標を比較
          if (state.stations[i].latlng.equals(latlng)) {
            return state.stations[i];
          }
        }
        return null;
      }
      /**
       * 2つの駅間を接続する既存の線路パスを探索し、そのパスを構成するLatLngsを返す。
       * グラフ探索（BFS）により、連続した線路・駅プラットフォームを繋ぐ。
       * @param {L.LatLng} startStationLatLng - 始点駅の中心緯度経度。
       * @param {L.LatLng} endStationLatLng - 終点駅の中心緯度経度。
       * @returns {L.LatLng[]|null} - 見つかった線路パスのLatLng配列。見つからない場合はnullを返す。
       */
      function findPathBetweenStations_GraphSearch(
        startStationLatLng,
        endStationLatLng
      ) {
        var thresholdMeters = CONFIG.snapThresholdMeters;

        var startStationObj = findStationByLatLng(startStationLatLng);
        var endStationObj = findStationByLatLng(endStationLatLng);

        // 駅が見つからない、または同じ駅同士の探索は無効
        if (
          !startStationObj ||
          !endStationObj ||
          startStationObj.id === endStationObj.id
        ) {
          return null;
        }

        // 1. 探索のためのグラフ構造（隣接リスト）を作成
        var adj = {};
        var nodes = {};

        function addNode(id, latlng) {
          if (!adj[id]) {
            adj[id] = [];
            nodes[id] = { latlng: latlng };
          }
        }
        function addEdge(u, v, path) {
          adj[u].push({ to: v, path: path });
          adj[v].push({ to: u, path: [].concat(path).reverse() }); // 逆方向も追加
        }

        var i;
        // 線路をグラフに追加
        for (i = 0; i < state.tracks.length; i++) {
          var track = state.tracks[i];
          if (!track.latlngs || track.latlngs.length < 2) continue;
          var trackStartId = "track_" + track.id + "_start";
          var trackEndId = "track_" + track.id + "_end";
          addNode(trackStartId, track.latlngs[0]);
          addNode(trackEndId, track.latlngs[track.latlngs.length - 1]);
          addEdge(trackStartId, trackEndId, track.latlngs);
        }

        // 駅のプラットフォームをグラフに追加
        for (i = 0; i < state.stations.length; i++) {
          var station = state.stations[i];
          if (!station.latlngs || station.latlngs.length < 2) continue;
          var stationStartId = "station_" + station.id + "_start";
          var stationEndId = "station_" + station.id + "_end";
          addNode(stationStartId, station.latlngs[0]);
          addNode(stationEndId, station.latlngs[station.latlngs.length - 1]);
          addEdge(stationStartId, stationEndId, station.latlngs);
        }

        // ノード間の接続（線路同士、駅と線路など）をエッジとして追加
        var nodeIds = Object.keys(nodes);
        for (i = 0; i < nodeIds.length; i++) {
          for (var j = i + 1; j < nodeIds.length; j++) {
            var id1 = nodeIds[i];
            var id2 = nodeIds[j];
            var parts1 = id1.split("_");
            var parts2 = id2.split("_");

            // 同じオブジェクト（線路 or 駅）の端点同士は接続しない
            // IDは'type__randomid_endpoint'の形式なので、ID部分は2番目以降
            if (
              parts1[0] === parts2[0] &&
              parts1.length > 2 &&
              parts2.length > 2 &&
              parts1[2] === parts2[2]
            ) {
              continue;
            }

            if (
              nodes[id1].latlng.distanceTo(nodes[id2].latlng) < thresholdMeters
            ) {
              addEdge(id1, id2, [nodes[id1].latlng, nodes[id2].latlng]);
            }
          }
        }

        // 2. BFSで始点駅の端から終点駅の端への経路を探索
        var startNodeIds = [
          "station_" + startStationObj.id + "_start",
          "station_" + startStationObj.id + "_end",
        ];
        var endNodeIds = [
          "station_" + endStationObj.id + "_start",
          "station_" + endStationObj.id + "_end",
        ];

        var queue = [];
        var visited = {};

        // 始点駅の両端をキューの初期値として追加
        for (i = 0; i < startNodeIds.length; i++) {
          var startId = startNodeIds[i];
          if (nodes[startId]) {
            queue.push({ id: startId, path: [nodes[startId].latlng] });
            visited[startId] = true;
          }
        }

        while (queue.length > 0) {
          var current = queue.shift();

          // 終点駅のどちらかの端に到達したら成功
          if (endNodeIds.includes(current.id)) {
            return current.path;
          }

          var neighbors = adj[current.id] || [];
          for (i = 0; i < neighbors.length; i++) {
            var neighbor = neighbors[i];
            if (!visited[neighbor.to]) {
              visited[neighbor.to] = true;

              var newPath = [].concat(current.path);
              var segmentPath = neighbor.path;

              // 接続点で座標が重複しないようにパスを結合
              if (
                newPath.length > 0 &&
                segmentPath.length > 0 &&
                newPath[newPath.length - 1].equals(segmentPath[0])
              ) {
                Array.prototype.push.apply(newPath, segmentPath.slice(1));
              } else {
                Array.prototype.push.apply(newPath, segmentPath);
              }

              queue.push({ id: neighbor.to, path: newPath });
            }
          }
        }

        return null; // パスが見つからなかった場合
      }

      /**
       * 全てのモードを非アクティブにするヘルパー関数
       */
      function deactivateAllModes() {
        if (state.planning.type) {
          if (state.planning.ghost) {
            map.removeLayer(state.planning.ghost);
            state.planning.ghost = null;
          }
          if (state.planning.costTooltip) {
            map.removeLayer(state.planning.costTooltip);
            state.planning.costTooltip = null;
          }
          state.planning.points = [];
          state.planning.type = null;
          ui.resetBuildModeActive();
        }
        if (state.lineBuildingMode) {
          cancelLineBuilding();
        }
        if (state.demolitionMode) {
          cancelDemolition();
        }
        map.dragging.enable(); // マップドラッグを有効化
        map.getContainer().classList.remove("build-mode-cursor"); // カーソルを元に戻す
      }

      // --- EVENT LISTENERS: 各種UIイベントハンドラの設定 ---

      // 建設ボタン
      document.getElementById("build-ground").onclick = function () {
        deactivateAllModes();
        startPlanning("ground");
      };
      document.getElementById("build-viaduct").onclick = function () {
        deactivateAllModes();
        startPlanning("viaduct");
      };
      document.getElementById("build-tunnel").onclick = function () {
        deactivateAllModes();
        startPlanning("tunnel");
      };
      document.getElementById("build-station").onclick = function () {
        deactivateAllModes();
        startPlanning("station");
      };
      ui.confirmBuildButton.onclick = confirmBuild;

      // 列車ショップボタン
      ui.buyTrainButton.onclick = buySelectedTrain;
      ui.assignTrainToLineButton.onclick = assignSelectedTrainToLine;
      ui.lineSelectForAssignment.onchange = function () {
        ui.assignTrainToLineButton.disabled =
          !state.selectedTrainToAssignId || !ui.lineSelectForAssignment.value;
      };

      // 路線設定ボタン
      ui.startLineBuildButton.onclick = function () {
        deactivateAllModes();
        startLineBuilding();
      };
      ui.confirmLineBuildButton.onclick = confirmLineBuilding;
      ui.cancelLineBuildButton.onclick = cancelLineBuilding;

      // 解体ボタン
      ui.demolitionModeButton.onclick = function () {
        deactivateAllModes();
        startDemolitionMode();
      };
      ui.confirmDemolitionButton.onclick = confirmDemolition;
      ui.cancelDemolitionButton.onclick = cancelDemolition;

      // セーブ/ロードボタン (既存)
      ui.saveGameButton.onclick = saveGame;
      ui.loadGameButton.onclick = loadGame;

      // セーブデータ出力/入力ボタン
      ui.exportSaveButton.onclick = exportSaveData;
      ui.importSaveButton.onclick = importSaveData;
      // ui.generateShareUrlButton.onclick = generateShareUrl; // 削除

      // ゲーム速度ボタン
      var speedButtons = document.querySelectorAll(
        "#game-speed-control .speed-btn"
      );
      for (var i = 0; i < speedButtons.length; i++) {
        speedButtons[i].onclick = function () {
          setGameSpeed(parseInt(this.dataset.speed));
        };
      }

      // 左パネル開閉ボタン
      ui.toggleLeftPanelButton.onclick = function () {
        document.getElementById("left-panel").classList.toggle("collapsed");
        var icon = this.querySelector("i");
        if (icon.classList.contains("fa-chevron-left")) {
          icon.classList.remove("fa-chevron-left");
          icon.classList.add("fa-chevron-right");
        } else {
          icon.classList.remove("fa-chevron-right");
          icon.classList.add("fa-chevron-left");
        }
      };

      // --- PLANNING (TRACK/STATION CONSTRUCTION): 線路・駅建設モードのロジック ---
      var dragging = false; // マップドラッグ中かどうかのフラグ

      /**
       * 建設モードを開始または終了する。
       * @param {string} type - 建設タイプ ('ground', 'viaduct', 'tunnel', 'station').
       */
      function startPlanning(type) {
        if (state.planning.type === type) {
          // 同じボタンを再度押したら解除
          deactivateAllModes(); // 全モードを解除
          ui.showMessage("建設モードを解除しました。", "info");
          return;
        }

        // 新しい建設モードを開始
        deactivateAllModes();
        state.planning.type = type;
        state.planning.points = [];
        if (state.planning.ghost) {
          map.removeLayer(state.planning.ghost);
        } // 既存のゴーストをクリア
        state.planning.ghost = null;
        map.dragging.disable(); // 建設中はマップドラッグを無効化
        map.getContainer().classList.add("build-mode-cursor"); // カーソルを変更
        ui.showMessage(
          (type === "station" ? "駅" : "線路") +
            "建設モード: マップをドラッグして建設します。",
          "info",
          true
        );
        ui.setBuildModeActive(type);
      }

      // --- MAP EVENTS FOR CONSTRUCTION ---
      map.on("mousedown", function (e) {
        if (!state.planning.type) return; // 建設モードでない場合は何もしない

        dragging = true;
        var snappedPoint = snapPoint(e.latlng);
        state.planning.points = [snappedPoint]; // 最初の点を設定

        // ゴースト表示を更新
        if (state.planning.ghost) {
          map.removeLayer(state.planning.ghost);
        }
        if (state.planning.type === "station") {
          state.planning.ghost = L.polyline(
            [snappedPoint, snappedPoint],
            ghostStyle("station")
          ).addTo(map);
        } else {
          state.planning.ghost = L.polyline(
            [snappedPoint, snappedPoint],
            ghostStyle(state.planning.type)
          ).addTo(map);
        }

        // コストツールチップの作成
        if (!state.planning.costTooltip) {
          state.planning.costTooltip = L.divIcon({
            className: "construction-cost-tooltip",
            html: "ドラッグして長さを決定",
            iconAnchor: [0, 0], // 後で位置を調整
          });
          state.planning.costTooltip = L.marker(e.latlng, {
            icon: state.planning.costTooltip,
          }).addTo(map);
        }
      });

      map.on("mousemove", function (e) {
        if (
          dragging &&
          state.planning.type &&
          state.planning.points.length > 0
        ) {
          var snappedPoint = snapPoint(e.latlng);
          state.planning.ghost.setLatLngs([
            state.planning.points[0],
            snappedPoint,
          ]);

          // コストツールチップの更新
          if (state.planning.costTooltip) {
            var len = state.planning.points[0].distanceTo(snappedPoint);
            var cost = 0;
            if (state.planning.type === "station") {
              cost =
                CONFIG.costs.station.base + CONFIG.costs.station.perMeter * len;
            } else {
              cost = CONFIG.costs[state.planning.type].perMeter * len;
            }
            state.planning.costTooltip.setLatLng(e.latlng);
            state.planning.costTooltip
              .getIcon()
              .options.html =
              "長さ: " +
              len.toFixed(1) +
              "m<br>コスト: $" +
              Math.round(cost).toLocaleString();
            state.planning.costTooltip.redraw(); // アイコンのHTML変更を反映
          }
        }
      });

      map.on("mouseup", function (e) {
        if (
          dragging &&
          state.planning.type &&
          state.planning.points.length > 0
        ) {
          dragging = false;
          var snappedPoint = snapPoint(e.latlng);

          if (!state.planning.points[0].equals(snappedPoint)) {
            state.planning.points.push(snappedPoint);
          } else {
            if (state.planning.type === "station") {
              // 1点しかクリックされなかった場合、デフォルトのプラットフォーム長を生成
              var defaultLength = 20; // メートル
              var angle = 45; // 北東
              var latOffset = defaultLength / 111111;
              var lngOffset =
                defaultLength /
                (111111 * Math.cos((snappedPoint.lat * Math.PI) / 180));
              state.planning.points.push(
                L.latLng(
                  snappedPoint.lat +
                    latOffset * Math.cos((angle * Math.PI) / 180),
                  snappedPoint.lng +
                    lngOffset * Math.sin((angle * Math.PI) / 180)
                )
              );
            } else {
              ui.showMessage(
                "線路は2つの異なる点で構成する必要があります。",
                "warning",
                false,
                3000
              );
              if (state.planning.ghost) {
                map.removeLayer(state.planning.ghost);
                state.planning.ghost = null;
              }
              state.planning.points = [];
              ui.confirmBuildButton.disabled = true;
              ui.confirmBuildButton.textContent = "建設確定";
              // コストツールチップを削除
              if (state.planning.costTooltip) {
                map.removeLayer(state.planning.costTooltip);
                state.planning.costTooltip = null;
              }
              return;
            }
          }

          var cost = 0;
          var len = state.planning.points[0].distanceTo(
            state.planning.points[1]
          );
          if (state.planning.type === "station") {
            cost =
              CONFIG.costs.station.base + CONFIG.costs.station.perMeter * len;
          } else {
            cost = CONFIG.costs[state.planning.type].perMeter * len;
          }
          ui.confirmBuildButton.textContent =
            "建設確定 ($" + Math.round(cost).toLocaleString() + ")";
          ui.confirmBuildButton.disabled = state.assets < cost;

          // コストツールチップを削除
          if (state.planning.costTooltip) {
            map.removeLayer(state.planning.costTooltip);
            state.planning.costTooltip = null;
          }
        }
      });

      // --- SNAP TO NEARBY TRACK/STATION ---
      /**
       * 最も近い既存の線路の端点や駅に緯度経度をスナップさせる。
       * @param {L.LatLng} latlng - スナップ対象の緯度経度。
       * @returns {L.LatLng} - スナップされた緯度経度、または元の緯度経度。
       */
      function snapPoint(latlng) {
        var closest = { point: latlng, dist: Infinity };
        var currentPointPx = map.latLngToLayerPoint(latlng);
        var i;
        var snapCandidates = [];

        // 既存の線路の端点
        for (i = 0; i < state.tracks.length; i++) {
          snapCandidates.push(state.tracks[i].latlngs[0]);
          snapCandidates.push(
            state.tracks[i].latlngs[state.tracks[i].latlngs.length - 1]
          );
        }

        // 既存の駅のプラットフォームの端点をスナップ候補に追加
        for (i = 0; i < state.stations.length; i++) {
          // snapCandidates.push(state.stations[i].latlng); // 中心点ではなく端点を候補にする
          if (
            state.stations[i].latlngs &&
            state.stations[i].latlngs.length >= 2
          ) {
            snapCandidates.push(state.stations[i].latlngs[0]);
            snapCandidates.push(
              state.stations[i].latlngs[state.stations[i].latlngs.length - 1]
            );
          }
        }

        for (i = 0; i < snapCandidates.length; i++) {
          var p = snapCandidates[i];
          var d = currentPointPx.distanceTo(map.latLngToLayerPoint(p));
          if (d < closest.dist && d < CONFIG.snapThresholdPixels) {
            closest = { point: p, dist: d };
          }
        }

        return closest.point;
      }
      // --- GHOST STYLE ---
      /**
       * 建設モードの仮表示（ゴースト）のスタイルを返す。
       * @param {string} type - 建設タイプ。
       * @returns {object} - Leafletのポリラインスタイルオブジェクト。
       */
      function ghostStyle(type) {
        var styles = {
          ground: { color: "#007bff", weight: 4, dashArray: "10,10" },
          viaduct: { color: "#0a0", weight: 4, dashArray: "5,5" },
          tunnel: { color: "#a0a", weight: 4, dashArray: "2,8" },
          station: {
            color: "#d9534f",
            weight: 6,
            opacity: 0.7,
            dashArray: "5, 10",
          },
          lineGhost: { color: "#888", weight: 5, dashArray: "5,10" }, // 路線設定中の仮線
        };
        return styles[type] || { color: "#000", weight: 4 };
      }

      // --- CONFIRM BUILD (TRACK/STATION): 建設の確定ロジック ---
      function confirmBuild() {
        if (!state.planning.type) {
          ui.showMessage("建設モードが選択されていません。", "warning");
          return;
        }
        if (state.planning.points.length < 2) {
          ui.showMessage("建設点が不足しています。", "warning", false, 3000);
          return;
        }

        var type = state.planning.type;
        var actualCost;
        var buildMessage;
        var points = state.planning.points;
        var len = points[0].distanceTo(points[1]);

        if (type === "station") {
          actualCost =
            CONFIG.costs.station.base + CONFIG.costs.station.perMeter * len;
          buildMessage = "プラットフォーム長 " + len.toFixed(1) + "m の駅";
        } else {
          actualCost = CONFIG.costs[type].perMeter * len;
          buildMessage =
            (type === "ground"
              ? "地上線"
              : type === "viaduct"
              ? "高架線"
              : "トンネル") +
            " (" +
            len.toFixed(1) +
            "m)";
        }

        if (state.assets < actualCost) {
          ui.showMessage("資金不足: 建設できません。", "error", false, 5000);
          return;
        }

        state.assets -= actualCost;

        if (type === "station") {
          var stationId = generateUniqueId();
          var stationName = "無名駅" + (state.stations.length + 1);
          var stationCenter = points[0];

          // 駅ホーム本体レイヤー
          var platformBodyLayer = L.polyline(points, {
            className: "station-platform-body",
            id: stationId,
          }).addTo(map);
          // 駅ホーム縁レイヤー
          var platformEdgeLayer = L.polyline(points, {
            className: "station-platform-edge",
            id: stationId,
          }).addTo(map);

          var marker = L.marker(stationCenter, {
            icon: L.divIcon({
              className: "station-marker",
              iconSize: [16, 16],
              html: "", // 路線設定モードで数字が入る
            }),
            id: stationId,
          }).addTo(map);

          var newStation = {
            id: stationId,
            name: stationName,
            latlng: stationCenter,
            latlngs: points,
            platformLength: len,
            bodyLayer: platformBodyLayer, // レイヤーを分割
            edgeLayer: platformEdgeLayer, // レイヤーを分割
            marker: marker,
            revenueMultiplier: 1.0, // 初期値は1.0、後で人口密度で更新
            passengersWaiting: [], // 新規追加: 駅で待機中の乗客リスト
            maxWaitingPassengers: Math.floor(
              len * CONFIG.maxWaitingPassengersPerMeterOfPlatform
            ), // 新規追加
          };
          state.stations.push(newStation);

          // 駅名ツールチップをバインド
          marker.bindTooltip(newStation.name, {
            permanent: true,
            direction: "top",
            className: "station-name-tooltip",
          });
          marker.getTooltip()._container.style.display =
            map.getZoom() >= 13 ? "block" : "none"; // ズームレベルに応じて表示/非表示

          marker.on("click", function (e) {
            e.originalEvent.stopPropagation();
            var currentId = e.target.options.id;
            if (state.lineBuildingMode) {
              handleStationClickForLineBuilding(currentId);
            } else if (state.demolitionMode) {
              selectForDemolition("station", currentId);
            } else {
              // 修正2: 通常クリック時にポップアップを開く
              e.target.openPopup();
            }
          });
          platformBodyLayer.on("click", function (e) {
            e.originalEvent.stopPropagation();
            var currentId = e.target.options.id;
            if (state.demolitionMode) {
              selectForDemolition("station", currentId);
            }
          });
          platformEdgeLayer.on("click", function (e) {
            e.originalEvent.stopPropagation();
            var currentId = e.target.options.id;
            if (state.demolitionMode) {
              selectForDemolition("station", currentId);
            }
          });

          fetch(
            "https://nominatim.openstreetmap.org/reverse?format=json&lat=" +
              stationCenter.lat +
              "&lon=" +
              stationCenter.lng +
              "&zoom=18&addressdetails=1"
          )
            .then(function (response) {
              return response.json();
            })
            .then(function (data) {
              var resolvedName =
                "無名駅" + (stationCenter.lat.toFixed(4) + ")");
              // var revenueMultiplier = 1.0; // 既存の地名APIからの収益倍率ロジックは削除

              if (data && data.address) {
                var addr = data.address;
                // 地名APIからの収益倍率設定ロジックは削除
                var nameCandidate =
                  addr.station ||
                  addr.railway ||
                  addr.town ||
                  addr.village ||
                  addr.suburb ||
                  addr.neighbourhood ||
                  addr.city;
                if (nameCandidate) {
                  resolvedName = nameCandidate.match(/(区|市|町|村|郡)$/)
                    ? nameCandidate
                    : nameCandidate + "駅";
                }
              }

              newStation.name = resolvedName;
              // newStation.revenueMultiplier = revenueMultiplier; // 既存の地名APIからの収益倍率設定ロジックは削除

              // 人口密度に基づいて収益倍率を設定
              setStationRevenueMultiplier(newStation);
              newStation.marker.getTooltip().setContent(newStation.name); // ツールチップも更新

              ui.showMessage(
                resolvedName +
                  "を建設しました！ (" +
                  buildMessage +
                  ", $" +
                  Math.round(actualCost).toLocaleString() +
                  ")",
                "success",
                false,
                2500
              );
              ui.renderTrainShop();
            })
            .catch(function (error) {
              console.error("地名APIの取得に失敗しました:", error);
              // 地名APIが失敗しても人口密度は設定する
              newStation.name = "無名駅 (" + stationCenter.lat.toFixed(4) + ")";
              setStationRevenueMultiplier(newStation);
              newStation.marker.getTooltip().setContent(newStation.name); // ツールチップも更新
              ui.showMessage(
                "地名取得失敗: " +
                  newStation.name +
                  "を建設しました。 (" +
                  buildMessage +
                  ", $" +
                  Math.round(actualCost).toLocaleString() +
                  ")",
                "warning",
                false,
                2500
              );
            });
        } else {
          // 線路建設
          var trackId = generateUniqueId();
          var railLayer = L.polyline(points, {
            className: "track-rail track-" + type + "-rail",
            id: trackId,
          }).addTo(map);
          var sleeperLayer = L.polyline(points, {
            className: "track-sleeper track-" + type + "-sleeper",
            id: trackId,
          }).addTo(map);

          state.tracks.push({
            id: trackId,
            latlngs: points,
            railLayer: railLayer, // レイヤーを分割
            sleeperLayer: sleeperLayer, // レイヤーを分割
            type: type,
          });

          railLayer.on("click", function (e) {
            e.originalEvent.stopPropagation();
            if (state.demolitionMode) {
              selectForDemolition("track", this.options.id);
            }
          });
          sleeperLayer.on("click", function (e) {
            e.originalEvent.stopPropagation();
            if (state.demolitionMode) {
              selectForDemolition("track", e.target.options.id);
            }
          });

          ui.showMessage(
            buildMessage +
              "を建設しました！ ($" +
              Math.round(actualCost).toLocaleString() +
              ")",
            "success",
            false,
            2000
          );
        }

        if (state.planning.ghost) {
          map.removeLayer(state.planning.ghost);
          state.planning.ghost = null;
        }
        state.planning.points = [];
        state.planning.type = null;
        map.dragging.enable();
        map.getContainer().classList.remove("build-mode-cursor"); // カーソルを元に戻す
        ui.resetBuildModeActive();
        ui.updateFinance();
      }

      // ズームレベルに応じて駅名ツールチップの表示/非表示を切り替える
      map.on("zoomend", function () {
        var currentZoom = map.getZoom();
        for (var i = 0; i < state.stations.length; i++) {
          var station = state.stations[i];
          if (station.marker && station.marker.getTooltip()) {
            station.marker.getTooltip()._container.style.display =
              currentZoom >= 13 ? "block" : "none";
          }
        }
      });

      // --- TRAIN SHOP LOGIC: 列車ショップの機能 ---

      /** 購入する列車を選択する。 */
      function selectTrainToBuy(trainId) {
        state.selectedTrainToBuyId = trainId;
        ui.renderTrainShop();
      }

      /** 選択された列車を購入する。 */
      function buySelectedTrain() {
        var trainToBuyConfig = CONFIG.trains.find(function (t) {
          return t.id === state.selectedTrainToBuyId;
        });
        if (!trainToBuyConfig) {
          ui.showMessage("列車が選択されていません。", "warning");
          return;
        }
        if (state.assets < trainToBuyConfig.cost) {
          ui.showMessage("資金不足: 列車を購入できません。", "error", false, 5000);
          return;
        }

        state.assets -= trainToBuyConfig.cost;
        var newTrain = {
          id: generateUniqueId(),
          type: trainToBuyConfig.id,
          name: trainToBuyConfig.name,
          cars: trainToBuyConfig.cars,
          cost: trainToBuyConfig.cost,
          trainColor: trainToBuyConfig.trainColor, // SVG生成用にtrainColorを保持
          speed: trainToBuyConfig.defaultSpeed,
          totalLength:
            trainToBuyConfig.cars * CONFIG.trainCarDimensionsMeters.length,
          currentStationId: null,
          currentLineId: null,
          currentSegmentIndex: 0,
          direction: 1,
          progress: 0,
          isStopped: false,
          stopTimer: null,
          carMarkers: [], // 変更: carLayersからcarMarkersへ
          currentLatLng: null,
          currentHeading: 0,
          currentPassengers: [], // 変更: 乗客オブジェクトの配列
          maxCapacity: trainToBuyConfig.cars * CONFIG.passengerCapacityPerCar, // 新規追加: 最大乗客容量
        };
        state.trains.push(newTrain);

        ui.updateFinance();
        ui.showMessage(trainToBuyConfig.name + "を購入しました！", "success", false, 2000);
        state.selectedTrainToBuyId = null;
        ui.renderTrainShop();
      }

      /** 路線に割り当てる列車を選択する。 */
      function selectTrainToAssign(trainId) {
        state.selectedTrainToAssignId = trainId;
        ui.renderTrainShop();
      }

      /**
       * 指定された路線の総車両数と総列車数を更新する。
       * 列車が路線に割り当てられたり、割り当てが解除されたりするたびに呼び出す。
       * @param {string} lineId - 路線のID。
       */
      function updateLineTrainCounts(lineId) {
        var line = getLineById(lineId);
        if (!line) return;

        line.totalTrainsOnLine = 0;
        line.totalCarsOnLine = 0;

        for (var i = 0; i < state.trains.length; i++) {
          var train = state.trains[i];
          if (train.currentLineId === lineId) {
            line.totalTrainsOnLine++;
            line.totalCarsOnLine += train.cars;
          }
        }
      }

      /** 選択された列車を路線に割り当てる。 */
      function assignSelectedTrainToLine() {
        var trainId = state.selectedTrainToAssignId;
        var lineId = ui.lineSelectForAssignment.value;

        if (!trainId || !lineId) {
          ui.showMessage("列車と路線を選択してください。", "warning");
          return;
        }

        var train = state.trains.find(function (t) {
          return t.id === trainId;
        });
        var line = getLineById(lineId);

        if (!train || !line) {
          ui.showMessage("無効な列車または路線です。", "error");
          return;
        }
        if (line.segments.length === 0) {
          ui.showMessage("選択された路線には有効なセグメントがありません。", "warning");
          return;
        }

        // 以前の路線から列車を外す
        if (train.currentLineId) {
          var oldLine = getLineById(train.currentLineId);
          if (oldLine && oldLine.assignedTrainIds) {
            oldLine.assignedTrainIds = oldLine.assignedTrainIds.filter(
              function (id) {
                return id !== train.id;
              }
            );
            updateLineTrainCounts(oldLine.id); // 以前の路線の列車数を更新
          }
          // 列車が路線から外れる際に、マップ上のマーカーを削除
          if (train.carMarkers) {
            for (var k = 0; k < train.carMarkers.length; k++) {
              if (train.carMarkers[k] && map.hasLayer(train.carMarkers[k])) {
                map.removeLayer(train.carMarkers[k]);
              }
            }
          }
          train.carMarkers = []; // マーカー配列をクリア
        }

        train.currentLineId = line.id;
        train.currentSegmentIndex = 0;
        train.direction = 1;
        train.progress = 0;
        train.isStopped = false;
        train.stopTimer = null;
        train.currentStationId = null;
        train.currentPassengers = []; // 路線割り当て時に乗客をリセット

        var firstSegment = line.segments[0];
        if (firstSegment && firstSegment.latlngs.length > 0) {
          train.currentLatLng = firstSegment.latlngs[0];
          train.currentHeading = getHeading(
            firstSegment.latlngs[0],
            firstSegment.latlngs[1] || firstSegment.latlngs[0]
          );
        } else {
          console.warn("路線の最初のセグメントが見つかりません。");
          train.currentLineId = null;
          return;
        }

        if (!line.assignedTrainIds) {
          line.assignedTrainIds = [];
        }
        line.assignedTrainIds.push(train.id);

        updateLineTrainCounts(line.id); // 新しい路線の列車数を更新

        ui.showMessage(
          train.name + "を路線 " + line.name + "に割り当てました。",
          "success",
          false,
          2000
        );
        state.selectedTrainToAssignId = null;
        ui.renderTrainShop();
        renderTrains(); // 列車が割り当てられたらレンダリングを更新
      }

      // --- LINE BUILDING LOGIC: 路線設定の機能 ---

      /** 路線設定モードを開始する。 */
      function startLineBuilding() {
        if (state.lineBuildingMode) {
          cancelLineBuilding();
          return;
        }

        deactivateAllModes();
        state.lineBuildingMode = true;
        state.selectedStationsForLine = [];
        if (state.currentLineGhost) {
          map.removeLayer(state.currentLineGhost);
          state.currentLineGhost = null;
        }
        ui.showMessage(
          "路線設定モードを開始しました。駅をクリックして路線に追加してください。",
          "info",
          true
        );
        ui.setLineBuildModeActive(true);
        map.dragging.disable();

        var i;
        for (i = 0; i < state.stations.length; i++) {
          var station = state.stations[i];
          if (station.marker && station.marker._icon) {
            station.marker._icon.classList.add("station-marker-selectable");
          }
        }
        ui.updateSelectedStationsForLine();
      }

      /**
       * 路線設定モード中に駅がクリックされたときのハンドラ。
       * @param {string} stationId - クリックされた駅のID。
       */
      function handleStationClickForLineBuilding(stationId) {
        if (!state.lineBuildingMode) return;

        var station = getStationById(stationId);
        if (!station) return;

        var index = state.selectedStationsForLine.indexOf(stationId);
        if (index > -1) {
          removeStationFromLineBuilding(stationId);
          ui.showMessage(
            station.name + "を路線から削除しました。",
            "info",
            false,
            1500
          );
        } else {
          state.selectedStationsForLine.push(stationId);
          ui.showMessage(station.name + "を路線に追加しました。", "info", false, 1500);
          if (station.marker && station.marker._icon) {
            station.marker._icon.classList.add("selected-for-line");
          }
        }

        ui.updateSelectedStationsForLine();
        updateLineGhost();

        // 駅マーカーの番号を更新
        for (var i = 0; i < state.stations.length; i++) {
          var s = state.stations[i];
          var idx = state.selectedStationsForLine.indexOf(s.id);
          if (s.marker && s.marker.getElement()) {
            s.marker.getElement().innerHTML = idx > -1 ? idx + 1 : "";
          }
        }
      }

      /**
       * 路線設定モードから駅を削除する。
       * @param {string} stationIdToRemove - 削除する駅のID。
       */
      function removeStationFromLineBuilding(stationIdToRemove) {
        var index = state.selectedStationsForLine.indexOf(stationIdToRemove);
        if (index > -1) {
          state.selectedStationsForLine.splice(index, 1);
        }

        var station = getStationById(stationIdToRemove);
        if (station && station.marker && station.marker._icon) {
          station.marker._icon.classList.remove("selected-for-line");
          station.marker.getElement().innerHTML = ""; // 番号をクリア
        }
        ui.updateSelectedStationsForLine();
        updateLineGhost();

        // 残りの駅の番号を更新
        for (var i = 0; i < state.stations.length; i++) {
          var s = state.stations[i];
          var idx = state.selectedStationsForLine.indexOf(s.id);
          if (s.marker && s.marker.getElement()) {
            s.marker.getElement().innerHTML = idx > -1 ? idx + 1 : "";
          }
        }
      }

      /** 路線設定中の仮ポリライン（ゴースト）を更新する。 */
      function updateLineGhost() {
        if (state.currentLineGhost) {
          map.removeLayer(state.currentLineGhost);
          state.currentLineGhost = null;
        }
        if (state.selectedStationsForLine.length < 2) {
          return;
        }

        var ghostPath = [];
        var pathFound = true;
        for (var i = 0; i < state.selectedStationsForLine.length - 1; i++) {
          var startStation = getStationById(state.selectedStationsForLine[i]);
          var endStation = getStationById(state.selectedStationsForLine[i + 1]);
          if (startStation && endStation) {
            var segmentPath = findPathBetweenStations_GraphSearch(
              startStation.latlng,
              endStation.latlng
            );

            if (segmentPath) {
              if (
                ghostPath.length > 0 &&
                segmentPath.length > 0 &&
                ghostPath[ghostPath.length - 1].equals(segmentPath[0])
              ) {
                Array.prototype.push.apply(ghostPath, segmentPath.slice(1));
              } else {
                Array.prototype.push.apply(ghostPath, segmentPath);
              }
            } else {
              pathFound = false;
              ui.showMessage(
                "警告: " +
                  startStation.name +
                  " と " +
                  endStation.name +
                  " 間に接続された線路がありません。",
                "warning",
                false,
                4000
              );
              break;
            }
          }
        }

        if (pathFound && ghostPath.length >= 2) {
          state.currentLineGhost = L.polyline(
            ghostPath,
            ghostStyle("lineGhost")
          ).addTo(map);
        }
      }

      /** 路線設定を確定する。 */
      function confirmLineBuilding() {
        if (state.selectedStationsForLine.length < 2) {
          ui.showMessage("路線には2つ以上の駅が必要です。", "warning");
          return;
        }

        var totalLineDistance = 0;
        var lineSegmentsForTrainMovement = [];
        var linePathLatLngsForDisplay = [];
        var pathFoundSuccessfully = true;

        for (var i = 0; i < state.selectedStationsForLine.length - 1; i++) {
          var startStation = getStationById(state.selectedStationsForLine[i]);
          var endStation = getStationById(state.selectedStationsForLine[i + 1]);

          if (startStation && endStation) {
            var segmentPath = findPathBetweenStations_GraphSearch(
              startStation.latlng,
              endStation.latlng
            );

            if (segmentPath) {
              var distance = calculatePathDistance(segmentPath);
              totalLineDistance += distance;
              lineSegmentsForTrainMovement.push({
                startStationId: startStation.id,
                endStationId: endStation.id,
                latlngs: segmentPath,
                distance: distance,
              });
              if (linePathLatLngsForDisplay.length > 0) {
                Array.prototype.push.apply(
                  linePathLatLngsForDisplay,
                  segmentPath.slice(1)
                );
              } else {
                Array.prototype.push.apply(
                  linePathLatLngsForDisplay,
                  segmentPath
                );
              }
            } else {
              pathFoundSuccessfully = false;
              ui.showMessage(
                "エラー: " +
                  startStation.name +
                  "から" +
                  endStation.name +
                  "への経路が見つかりませんでした。路線を作成できません。",
                "error",
                false,
                5000
              );
              break;
            }
          }
        }

        if (!pathFoundSuccessfully) {
          return;
        }

        var actualLineCost =
          CONFIG.costs.line.base +
          CONFIG.costs.line.perMeter * totalLineDistance;
        if (state.assets < actualLineCost) {
          ui.showMessage("資金不足: 路線を確定できません。", "error", false, 5000);
          return;
        }

        state.assets -= actualLineCost;

        var lineId = generateUniqueId();
        var lineColor = CONFIG.lineColors[state.currentLineColorIndex];
        state.currentLineColorIndex =
          (state.currentLineColorIndex + 1) % CONFIG.lineColors.length;

        // 路線名を入力させるプロンプトを追加
        var lineName = prompt("路線の名前を入力してください:", "新路線");
        if (!lineName || lineName.trim() === "") {
          lineName = "無名路線 " + (state.lines.length + 1);
        }

        var lineLayer = L.polyline(linePathLatLngsForDisplay, {
          className: "line-color",
          color: lineColor,
          weight: 5,
          opacity: 0.8,
          id: lineId,
        }).addTo(map);

        state.lines.push({
          id: lineId,
          name: lineName, // 路線名を追加
          stationIds: [].concat(state.selectedStationsForLine),
          color: lineColor,
          layer: lineLayer,
          segments: lineSegmentsForTrainMovement,
          totalDistance: totalLineDistance,
          assignedTrainIds: [],
          totalTrainsOnLine: 0, // 新規追加: 路線上の総列車数
          totalCarsOnLine: 0, // 新規追加: 路線上の総車両数
        });

        ui.updateFinance();
        ui.showMessage(
          lineName +
            "を確定しました！ (総距離 " +
            totalLineDistance.toFixed(1) +
            "m, コスト $" +
            Math.round(actualLineCost).toLocaleString() +
            ")",
          "success",
          false,
          2000
        );
        cancelLineBuilding();
        ui.renderTrainShop();
      }

      /** 路線設定をキャンセルする。 */
      function cancelLineBuilding() {
        state.lineBuildingMode = false;
        var i;
        for (i = 0; i < state.selectedStationsForLine.length; i++) {
          var station = getStationById(state.selectedStationsForLine[i]);
          if (station && station.marker && station.marker._icon) {
            station.marker._icon.classList.remove("selected-for-line");
            station.marker.getElement().innerHTML = ""; // 番号をクリア
          }
        }
        state.selectedStationsForLine = [];
        if (state.currentLineGhost) {
          map.removeLayer(state.currentLineGhost);
          state.currentLineGhost = null;
        }
        ui.showMessage("路線設定をキャンセルしました。", "info");
        ui.setLineBuildModeActive(false);
        ui.updateSelectedStationsForLine();
        map.dragging.enable();

        for (i = 0; i < state.stations.length; i++) {
          var station = state.stations[i];
          if (station.marker && station.marker._icon) {
            station.marker._icon.classList.remove("station-marker-selectable");
          }
        }
      }

      // --- DEMOLITION LOGIC: 解体機能 ---
      /** 解体モードを開始する。 */
      function startDemolitionMode() {
        if (state.demolitionMode) {
          cancelDemolition();
          return;
        }
        deactivateAllModes();
        state.demolitionMode = true;
        state.selectedForDemolition = null;
        ui.showMessage(
          "解体モード: 解体したい線路や駅をクリックしてください。",
          "info",
          true
        );
        ui.setDemolitionModeActive(true);
        map.dragging.disable();
      }

      /**
       * 解体モード中にマップ上のオブジェクトがクリックされたときのハンドラ。
       * @param {string} type - 'track' または 'station'。
       * @param {string} id - オブジェクトのID。
       */
      function selectForDemolition(type, id) {
        if (!state.demolitionMode) return;

        var demolitionTargetDisplayMap = {
          track: function (id) {
            return "選択中: 線路 (ID: " + id.substring(0, 5) + "...)";
          },
          station: function (id) {
            var station = getStationById(id);
            return "選択中: 駅 (" + (station ? station.name : "不明") + ")";
          },
        };

        // ハイライト解除
        if (state.selectedForDemolition) {
          var prevType = state.selectedForDemolition.type;
          var prevId = state.selectedForDemolition.id;
          var prevObj =
            prevType === "track"
              ? getTrackById(prevId)
              : getStationById(prevId);
          if (prevObj) {
            if (prevType === "track") {
              if (prevObj.railLayer && prevObj.railLayer._path)
                prevObj.railLayer._path.classList.remove(
                  "selected-for-demolition"
                );
              if (prevObj.sleeperLayer && prevObj.sleeperLayer._path)
                prevObj.sleeperLayer._path.classList.remove(
                  "selected-for-demolition"
                );
            } else if (prevType === "station") {
              if (prevObj.bodyLayer && prevObj.bodyLayer._path)
                prevObj.bodyLayer._path.classList.remove(
                  "selected-for-demolition"
                );
              if (prevObj.edgeLayer && prevObj.edgeLayer._path)
                prevObj.edgeLayer._path.classList.remove(
                  "selected-for-demolition"
                );
              if (prevObj.marker && prevObj.marker._icon)
                prevObj.marker._icon.classList.remove(
                  "selected-for-demolition"
                );
            }
          }
        }

        // 新しいオブジェクトを選択し、ハイライト
        state.selectedForDemolition = { type: type, id: id };
        var currentObj =
          type === "track" ? getTrackById(id) : getStationById(id);
        if (currentObj) {
          if (type === "track") {
            if (currentObj.railLayer && currentObj.railLayer._path)
              currentObj.railLayer._path.classList.add(
                "selected-for-demolition"
              );
            if (currentObj.sleeperLayer && currentObj.sleeperLayer._path)
              currentObj.sleeperLayer._path.classList.add(
                "selected-for-demolition"
              );
          } else if (type === "station") {
            if (currentObj.bodyLayer && currentObj.bodyLayer._path)
              currentObj.bodyLayer._path.classList.add(
                "selected-for-demolition"
              );
            if (currentObj.edgeLayer && currentObj.edgeLayer._path)
              currentObj.edgeLayer._path.classList.add(
                "selected-for-demolition"
              );
            if (currentObj.marker && currentObj.marker._icon)
              currentObj.marker._icon.classList.add("selected-for-demolition");
          }
          ui.selectedDemolitionTargetDisplay.textContent =
            demolitionTargetDisplayMap[type](id);
        }
        ui.confirmDemolitionButton.disabled = false;
      }

      /** 選択されたオブジェクトを解体する。 */
      function confirmDemolition() {
        if (!state.selectedForDemolition) {
          ui.showMessage("解体するオブジェクトが選択されていません。", "warning");
          return;
        }

        var type = state.selectedForDemolition.type;
        var id = state.selectedForDemolition.id;
        var i;

        if (type === "track") {
          var trackIndex = state.tracks.findIndex(function (t) {
            return t.id === id;
          });
          if (trackIndex === -1) {
            return;
          }

          var trackToDemolish = state.tracks[trackIndex];
          map.removeLayer(trackToDemolish.railLayer);
          map.removeLayer(trackToDemolish.sleeperLayer);
          state.tracks.splice(trackIndex, 1);
          ui.showMessage("線路を解体しました。", "success", false, 2000);

          // この線路を使用していた可能性のある全ての路線を再検証・削除
          var affectedLines = state.lines.filter(function (line) {
            return !line.segments.every(function (seg) {
              var start = getStationById(seg.startStationId);
              var end = getStationById(seg.endStationId);
              return (
                start &&
                end &&
                findPathBetweenStations_GraphSearch(
                  start.latlng,
                  end.latlng
                ) !== null
              );
            });
          });
          for (i = 0; i < affectedLines.length; i++) {
            removeLine(affectedLines[i].id);
          }
        } else if (type === "station") {
          var stationIndex = state.stations.findIndex(function (s) {
            return s.id === id;
          });
          if (stationIndex === -1) {
            return;
          }
          var stationToDemolish = state.stations[stationIndex];

          map.removeLayer(stationToDemolish.bodyLayer);
          map.removeLayer(stationToDemolish.edgeLayer);
          map.removeLayer(stationToDemolish.marker);
          if (stationToDemolish.marker.getTooltip()) {
            map.removeLayer(stationToDemolish.marker.getTooltip());
          } // ツールチップも削除
          state.stations.splice(stationIndex, 1);
          ui.showMessage(
            stationToDemolish.name + "を解体しました。",
            "success",
            false,
            2000
          );

          // この駅を含む路線を全て削除
          var linesToRemove = state.lines.filter(function (line) {
            return line.stationIds.includes(id);
          });
          for (i = 0; i < linesToRemove.length; i++) {
            removeLine(linesToRemove[i].id);
          }
        }

        cancelDemolition();
        ui.renderTrainShop();
      }

      /** 路線を削除するヘルパー関数 */
      function removeLine(lineId) {
        var lineIndex = state.lines.findIndex(function (l) {
          return l.id === lineId;
        });
        if (lineIndex === -1) return;

        var lineToRemove = state.lines[lineIndex];

        var i, j;
        if (lineToRemove.assignedTrainIds) {
          for (i = 0; i < lineToRemove.assignedTrainIds.length; i++) {
            var train = state.trains.find(function (t) {
              return t.id === lineToRemove.assignedTrainIds[i];
            });
            if (train) {
              train.currentLineId = null;
              // 既存の carLayers を削除する代わりに carMarkers を削除
              if (train.carMarkers) {
                for (j = 0; j < train.carMarkers.length; j++) {
                  if (train.carMarkers[j] && map.hasLayer(train.carMarkers[j])) {
                    map.removeLayer(train.carMarkers[j]);
                  }
                }
                train.carMarkers = []; // クリア
              }
              train.currentLatLng = null;
              train.isStopped = true;
              if (train.stopTimer) clearTimeout(train.stopTimer);
              train.currentPassengers = [];
            }
          }
        }

        map.removeLayer(lineToRemove.layer);
        state.lines.splice(lineIndex, 1);
        ui.showMessage(
          "路線 " + lineToRemove.name + " が削除されました。",
          "info",
          false,
          3000
        );
        ui.renderTrainShop(); // 列車ショップも更新して、割り当て解除を反映
      }

      /** 解体モードをキャンセルする。 */
      function cancelDemolition() {
        if (state.selectedForDemolition) {
          var type = state.selectedForDemolition.type;
          var id = state.selectedForDemolition.id;
          var obj = type === "track" ? getTrackById(id) : getStationById(id);
          if (obj) {
            if (type === "track") {
              if (obj.railLayer && obj.railLayer._path)
                obj.railLayer._path.classList.remove(
                  "selected-for-demolition"
                );
              if (obj.sleeperLayer && obj.sleeperLayer._path)
                obj.sleeperLayer._path.classList.remove(
                  "selected-for-demolition"
                );
            } else if (type === "station") {
              if (obj.bodyLayer && obj.bodyLayer._path)
                obj.bodyLayer._path.classList.remove(
                  "selected-for-demolition"
                );
              if (obj.edgeLayer && obj.edgeLayer._path)
                obj.edgeLayer._path.classList.remove(
                  "selected-for-demolition"
                );
              if (obj.marker && obj.marker._icon)
                obj.marker._icon.classList.remove("selected-for-demolition");
            }
          }
        }
        state.demolitionMode = false;
        state.selectedForDemolition = null;
        ui.showMessage("解体モードをキャンセルしました。", "info");
        ui.setDemolitionModeActive(false);
        map.dragging.enable();
      }

      // --- TRAIN MOVEMENT LOGIC: 列車移動の計算と更新 ---
      /** 全列車の位置と状態を更新する。 */
      function updateTrains() {
        var deltaTime =
          (CONFIG.updateInterval / 1000) * state.gameSpeedMultiplier; // 秒単位
        var i;

        for (i = 0; i < state.trains.length; i++) {
          var train = state.trains[i];

          if (!train.currentLineId || train.isStopped) {
            continue;
          }

          var line = getLineById(train.currentLineId);
          if (!line || !line.segments || line.segments.length === 0) {
            console.warn(
              "Train " + train.id + ": Invalid line. Stopping train."
            );
            train.currentLineId = null;
            train.isStopped = true;
            continue;
          }

          var currentSegment = line.segments[train.currentSegmentIndex];
          if (
            !currentSegment ||
            !currentSegment.latlngs ||
            currentSegment.latlngs.length < 2
          ) {
            console.warn(
              "Train " + train.id + ": Invalid segment. Stopping train."
            );
            train.currentLineId = null;
            train.isStopped = true;
            continue;
          }

          var speed_mps = (train.speed * 1000) / 3600; // km/h を m/s に変換
          var distanceMoved = speed_mps * deltaTime;
          var segmentLength = currentSegment.distance;
          if (segmentLength === 0) {
            // ゼロ除算対策
            train.progress = train.direction === 1 ? 1.0 : 0;
            handleArrival(
              train,
              line,
              train.direction === 1
                ? line.stationIds[train.currentSegmentIndex + 1]
                : line.stationIds[train.currentSegmentIndex],
              train.progress
            );
            continue;
          }

          var progressChange = distanceMoved / segmentLength;
          train.progress += train.direction * progressChange;

          // 進行方向に応じて終点・始点チェック
          if (train.direction === 1 && train.progress >= 1.0) {
            // 順方向で終点到着
            var arrivedStationId =
              line.stationIds[train.currentSegmentIndex + 1];
            handleArrival(train, line, arrivedStationId, 1.0);
          } else if (train.direction === -1 && train.progress <= 0) {
            // 逆方向で始点到着
            var arrivedStationId = line.stationIds[train.currentSegmentIndex];
            handleArrival(train, line, arrivedStationId, 0);
          } else {
            // セグメント内を移動中
            var data = getLatLngAtProgressOnPath(
              currentSegment.latlngs,
              train.progress
            );
            if (data) {
              train.currentLatLng = data.latlng;
              train.currentHeading = data.heading;
              if (train.direction === -1) {
                train.currentHeading = (train.currentHeading + 180) % 360;
              }
            }
          }
        }

        renderTrains();
      }

      /**
       * 駅到着時の処理をまとめたヘルパー関数
       */
      function handleArrival(train, line, arrivedStationId, progressAtArrival) {
        train.progress = progressAtArrival;
        var station = getStationById(arrivedStationId); // station変数名に変更

        function moveToNextSegment() {
          if (train.direction === 1) {
            // 順方向
            if (train.currentSegmentIndex >= line.segments.length - 1) {
              // 路線の終点
              train.direction = -1; // 方向転換
            } else {
              train.currentSegmentIndex++;
              train.progress = 0;
            }
          } else {
            // 逆方向
            if (train.currentSegmentIndex <= 0) {
              // 路線の始点
              train.direction = 1; // 方向転換
            } else {
              train.currentSegmentIndex--;
              train.progress = 1.0;
            }
          }
        }

        if (
          station && // station変数名に変更
          station.platformLength >= train.totalLength
        ) {
          train.isStopped = true;
          train.currentStationId = arrivedStationId;
          train.currentLatLng = station.latlng; // station変数名に変更

          // --- 乗客の降車処理 ---
          var passengersDisembarked = 0;
          var remainingPassengers = [];
          for (var i = 0; i < train.currentPassengers.length; i++) {
            var passenger = train.currentPassengers[i];
            if (passenger.destinationStationId === arrivedStationId) {
              // 変更点: 駅のrevenueMultiplierを乗算
              state.assets +=
                CONFIG.passengerRevenuePerPerson * station.revenueMultiplier; // station変数名に変更
              passengersDisembarked++;
            } else {
              remainingPassengers.push(passenger);
            }
          }
          train.currentPassengers = remainingPassengers;
          if (passengersDisembarked > 0) {
            ui.showMessage(
              passengersDisembarked +
                "人の乗客が" +
                station.name + // station変数名に変更
                "で降車し、$" +
                (
                  passengersDisembarked *
                  CONFIG.passengerRevenuePerPerson *
                  station.revenueMultiplier // station変数名に変更
                ).toLocaleString() + // ここも表示に合わせて変更
                "の収益を得ました。",
              "success",
              false,
              2000
            );
          }

          // --- 乗客の乗車処理 (最適化) ---
          var availableCapacity =
            train.maxCapacity - train.currentPassengers.length;
          var passengersBoardedCount = 0;
          var passengersToBoard = [];
          var currentLineStationIds = line.stationIds;
          var nextStationId = null; // 列車が次に向かう駅のID

          // 現在停車している駅の路線のインデックスを取得
          var arrivedStationIndexInLine = currentLineStationIds.indexOf(arrivedStationId);

          if (arrivedStationIndexInLine !== -1) {
              if (train.direction === 1) {
                  // 順方向で到着した場合、次に向かう駅は路線の次の駅
                  if (arrivedStationIndexInLine + 1 < currentLineStationIds.length) {
                      nextStationId = currentLineStationIds[arrivedStationIndexInLine + 1];
                  }
              } else { // train.direction === -1 (逆方向)
                  // 逆方向で到着した場合、次に向かう駅は路線の前の駅
                  if (arrivedStationIndexInLine - 1 >= 0) {
                      nextStationId = currentLineStationIds[arrivedStationIndexInLine - 1];
                  }
              }
          }

          var tempPassengersWaiting = []; // 駅に残る乗客を一時的に保持する配列

          // 1. 次の停車駅を目的地とする乗客を優先的に乗せる
          for (var i = 0; i < station.passengersWaiting.length; i++) {
            var p = station.passengersWaiting[i];
            if (
              passengersBoardedCount < availableCapacity &&
              p.destinationStationId === nextStationId
            ) {
              passengersToBoard.push(p);
              passengersBoardedCount++;
            } else {
              tempPassengersWaiting.push(p);
            }
          }
          station.passengersWaiting = tempPassengersWaiting; // 処理済みの乗客を削除し、残りを更新

          tempPassengersWaiting = []; // リセット

          // 2. この路線の他の駅を目的地とする乗客を乗せる
          for (var i = 0; i < station.passengersWaiting.length; i++) {
            var p = station.passengersWaiting[i];
            if (
              passengersBoardedCount < availableCapacity &&
              currentLineStationIds.includes(p.destinationStationId)
            ) {
              passengersToBoard.push(p);
              passengersBoardedCount++;
            } else {
              tempPassengersWaiting.push(p);
            }
          }
          station.passengersWaiting = tempPassengersWaiting; // 処理済みの乗客を削除し、残りを更新

          // 3. 以前の「その他の駅を目的地とする乗客」を乗せるロジックを削除しました。
          //    これにより、列車は運行している路線上の駅を目的地とする乗客のみを乗せるようになります。

          Array.prototype.push.apply(train.currentPassengers, passengersToBoard);

          if (passengersBoardedCount > 0) {
            ui.showMessage(
              passengersBoardedCount +
                "人の乗客が" +
                station.name +
                "で乗車しました。",
              "info",
              false,
              2000
            );
          }

          train.stopTimer = setTimeout(function () {
            train.isStopped = false;
            train.currentStationId = null;
            moveToNextSegment();
            ui.renderTrainShop(); // 乗客数表示を更新するため
            setStationRevenueMultiplier(station); // 駅の待機乗客数も更新されるためポップアップを更新
          }, CONFIG.trainStopDuration / state.gameSpeedMultiplier); // 倍速適用
        } else {
          if (station) {
            // station変数名に変更
            ui.showMessage(
              train.name +
                "は" +
                station.name + // station変数名に変更
                "を通過します(プラットフォーム長不足または停車しない駅)。",
              "warning",
              false,
              3000
            );
          }
          moveToNextSegment();
        }
        ui.updateFinance(); // 収益更新
      }

      // --- PASSENGER GENERATION LOGIC: 乗客生成ロジック ---

      /**
       * 各駅で定期的に乗客を生成する。
       * 生成される乗客の数は、駅の人口密度と路線の供給状況に応じて変動する。
       */
      function generatePassengersAtStations() {
        var i, j;
        for (i = 0; i < state.stations.length; i++) {
          var station = state.stations[i];
          if (!station.revenueMultiplier) continue;

          // 人口密度に基づく基本乗客生成量
          var baseCount = Math.floor(
            CONFIG.basePassengerGeneration * station.revenueMultiplier
          );

          // この駅を通る路線の供給状況を考慮
          var totalLineCarsAtStation = 0;
          var linesServingStation = state.lines.filter(function (line) {
            return line.stationIds.includes(station.id);
          });

          for (j = 0; j < linesServingStation.length; j++) {
            totalLineCarsAtStation += linesServingStation[j].totalCarsOnLine;
          }

          // 供給量に応じた乗客生成ボーナス/ペナルティ
          // 輸送能力が過剰になると、供給係数の増加が鈍化、あるいは頭打ちになるように調整
          var supplyFactor = 1.0;
          if (totalLineCarsAtStation > 0) {
            var optimalTotalCars =
              linesServingStation.length * CONFIG.optimalCarsPerLineSegment;
            if (optimalTotalCars === 0)
              optimalTotalCars = CONFIG.optimalCarsPerLineSegment; // 路線がない場合のゼロ除算対策

            // ★修正4: supplyFactorの計算式を調整し、最大倍率を2.5から3.0に引き上げました
            supplyFactor =
              1 + Math.log(1 + totalLineCarsAtStation / optimalTotalCars) * 1.0; // 0.8を1.0に変更
            supplyFactor = Math.min(supplyFactor, 3.0); // 最大3.0倍に制限
          }

          var actualCount = Math.floor(baseCount * supplyFactor);

          // 駅の最大待機乗客数を超えないように生成量を制限
          var availableSlots =
            station.maxWaitingPassengers - station.passengersWaiting.length;
          actualCount = Math.min(actualCount, availableSlots);
          actualCount = Math.max(0, actualCount); // マイナスにならないように

          for (var k = 0; k < actualCount; k++) {
            var destinationStation = null;
            var possibleDestinationStations = [];

            // 修正箇所: 現在の駅が属する路線の中からランダムに1つ選び、その路線上の他の駅を目的地とする
            if (linesServingStation.length > 0) {
                var selectedLine = linesServingStation[Math.floor(Math.random() * linesServingStation.length)];
                for (var m = 0; m < selectedLine.stationIds.length; m++) {
                    var destId = selectedLine.stationIds[m];
                    if (destId !== station.id) { // 自分自身は目的地にしない
                        possibleDestinationStations.push(destId);
                    }
                }
            }

            if (possibleDestinationStations.length > 0) {
                // 接続可能な駅の中からランダムに選択
                var randomIndex = Math.floor(Math.random() * possibleDestinationStations.length);
                destinationStation = getStationById(possibleDestinationStations[randomIndex]);
            }
            // else: この駅がどの路線にも属していない、または単独の駅である場合、乗客は生成されない。
            // これにより、無駄な乗客が減り、降車率が上がる。

            if (destinationStation) { // destinationStation が null でない場合のみ乗客を追加
              station.passengersWaiting.push({
                id: generateUniqueId(),
                destinationStationId: destinationStation.id,
              });
            }
          }
          // 駅のポップアップを更新
          if (station.marker && station.marker.getPopup()) {
            setStationRevenueMultiplier(station); // これでポップアップも更新される
          }
        }
      }

      /**
       * ゲーム内時間を更新する。
       */
      function updateGameTime() {
        state.gameTime +=
          CONFIG.gameTimeInterval * state.gameSpeedMultiplier * CONFIG.gameTimeScale;
        ui.updateGameTimeDisplay();
      }

      /**
       * ゲーム速度を設定し、タイマーを再設定する。
       * @param {number} multiplier - 速度倍率 (例: 1, 2, 4, 8)
       */
      function setGameSpeed(multiplier) {
        state.gameSpeedMultiplier = multiplier;

        // 既存のインターバルをクリア
        if (state.trainUpdateIntervalId) {
          clearInterval(state.trainUpdateIntervalId);
        }
        if (state.passengerGenerationIntervalId) {
          clearInterval(state.passengerGenerationIntervalId);
        }
        if (state.gameTimeIntervalId) {
          clearInterval(state.gameTimeIntervalId);
        }

        // 新しいインターバルを設定
        state.trainUpdateIntervalId = setInterval(
          updateTrains,
          CONFIG.updateInterval / state.gameSpeedMultiplier
        );
        state.passengerGenerationIntervalId = setInterval(
          generatePassengersAtStations,
          CONFIG.passengerGenerationInterval / state.gameSpeedMultiplier
        );
        state.gameTimeIntervalId = setInterval(
          updateGameTime,
          CONFIG.gameTimeInterval / state.gameSpeedMultiplier
        );

        // UIのボタンのアクティブ状態を更新
        var speedButtons = document.querySelectorAll(
          "#game-speed-control .speed-btn"
        );
        for (var i = 0; i < speedButtons.length; i++) {
          if (parseInt(speedButtons[i].dataset.speed) === multiplier) {
            speedButtons[i].classList.add("active");
          } else {
            speedButtons[i].classList.remove("active");
          }
        }
        ui.showMessage("ゲーム速度を " + multiplier + "倍に設定しました。", "info", false, 1500);
      }

      // --- RENDER TRAINS: マップ上での列車の描画とアニメーション ---
<<<<<<< HEAD

      /**
       * 列車車両のSVG画像を生成するヘルパー関数。
       * @param {string} type - 'front' (先頭車両) または 'middle' (中間車両)。
       * @param {string} trainColor - 列車の色 (例: '#FF0000')。
       * @param {number} width - SVGの幅 (px)。
       * @param {number} height - SVGの高さ (px)。
       * @returns {string} SVGデータURI。
       */
      function generateTrainImageSVG(type, trainColor, width, height) {
        let svgContent;
        const strokeColor = "#333";
        const strokeWidth = Math.max(1, Math.min(2, width / 20)); // 幅に応じて線の太さを調整

        if (type === "front") {
          // 先頭車両のデザイン (やや丸みを帯びた先頭、ヘッドライト)
          svgContent = `
                <rect x="${strokeWidth / 2}" y="${strokeWidth / 2}" width="${
            width - strokeWidth
          }" height="${height - strokeWidth}" rx="${
            height * 0.1
          }" ry="${
            height * 0.1
          }" fill="${trainColor}" stroke="${strokeColor}" stroke-width="${strokeWidth}"/>
                <path d="M${width - strokeWidth / 2},${height * 0.2} L${
            width - strokeWidth / 2
          },${height * 0.8} L${width * 0.8},${
            height / 2
          } Z" fill="white" stroke="${strokeColor}" stroke-width="${
            strokeWidth / 2
          }" stroke-linejoin="round"/>
                <circle cx="${width * 0.9}" cy="${height * 0.25}" r="${
            height * 0.1
          }" fill="yellow" stroke="${strokeColor}" stroke-width="${
            strokeWidth / 2
          }"/>
                <circle cx="${width * 0.9}" cy="${height * 0.75}" r="${
            height * 0.1
          }" fill="yellow" stroke="${strokeColor}" stroke-width="${
            strokeWidth / 2
          }"/>
            `;
        } else {
          // 中間車両のデザイン (シンプルな長方形、窓、車輪)
          svgContent = `
                <rect x="${strokeWidth / 2}" y="${strokeWidth / 2}" width="${
            width - strokeWidth
          }" height="${height - strokeWidth}" rx="${
            height * 0.1
          }" ry="${
            height * 0.1
          }" fill="${trainColor}" stroke="${strokeColor}" stroke-width="${strokeWidth}"/>
                <rect x="${width * 0.2}" y="${height * 0.2}" width="${
            width * 0.2
          }" height="${height * 0.3}" fill="skyblue" stroke="${strokeColor}" stroke-width="${
            strokeWidth / 2
          }"/>
                <rect x="${width * 0.6}" y="${height * 0.2}" width="${
            width * 0.2
          }" height="${height * 0.3}" fill="skyblue" stroke="${strokeColor}" stroke-width="${
            strokeWidth / 2
          }"/>
                <circle cx="${width * 0.25}" cy="${height * 0.75}" r="${
            height * 0.1
          }" fill="black"/>
                <circle cx="${width * 0.75}" cy="${height * 0.75}" r="${
            height * 0.1
          }" fill="black"/>
            `;
        }

        // URLエンコードしてデータURIとして返す
        return (
          "data:image/svg+xml;utf8," +
          encodeURIComponent(
            `<svg xmlns="http://www.w3.org/2000/svg" width="${width}" height="${height}" viewBox="0 0 ${width} ${height}">${svgContent}</svg>`
          )
        );
      }

      /** 全列車の車両をマップ上に描画または更新する。 */
=======
      /** 全列車の位置と状態を更新する。 */
>>>>>>> 7758c9bfa2fa1baa0af77b0893d5a199414fe89e
      function renderTrains() {
        var i, j;
        for (i = 0; i < state.trains.length; i++) {
          var train = state.trains[i];

          if (!train.currentLineId || !train.currentLatLng) {
            // 列車が路線に割り当てられていない、または位置情報がない場合は、既存のマーカーを削除
            if (train.carMarkers) {
              for (j = 0; j < train.carMarkers.length; j++) {
                if (train.carMarkers[j] && map.hasLayer(train.carMarkers[j])) {
                  map.removeLayer(train.carMarkers[j]);
                }
              }
            }
            train.carMarkers = []; // クリア
            continue;
          }

          var line = getLineById(train.currentLineId);
          if (!line) continue;

          var carLengthMeters = CONFIG.trainCarDimensionsMeters.length;
          var currentSegment = line.segments[train.currentSegmentIndex];
          var headDistanceInSegment = currentSegment.distance * train.progress;

          // carMarkers配列のサイズ調整
          // 既存のマーカー数が車両数と異なる場合は、すべて削除して再作成
          if (!train.carMarkers || train.carMarkers.length !== train.cars) {
            if (train.carMarkers) {
              for (j = 0; j < train.carMarkers.length; j++) {
                if (train.carMarkers[j] && map.hasLayer(train.carMarkers[j])) {
                  map.removeLayer(train.carMarkers[j]);
                }
              }
            }
            // 修正箇所: train.cars が不正な値の場合に 0 にフォールバック
            train.carMarkers = new Array(train.cars || 0);
          }

          for (j = 0; j < train.cars; j++) {
            // 各車両の中心が先頭からどれだけ離れているか
            var carCenterDistance =
              headDistanceInSegment - j * carLengthMeters - carLengthMeters / 2;

            var pointData;
            // 現在のセグメント内で車両の位置を計算
            if (
              carCenterDistance >= 0 &&
              carCenterDistance <= currentSegment.distance
            ) {
              pointData = getPointAtDistance(
                currentSegment.latlngs,
                carCenterDistance
              );
            } else {
              // セグメント外の車両は、先頭車両の方向へ延長線上に配置 (簡易的な処理)
              // このロジックは、列車が複数のセグメントにまたがる場合に正確な描画を保証しないが、
              // 現在の実装では単一セグメント内でのみ列車を描画するため、問題ない。
              // 列車がセグメントをまたぐ場合は、より複雑なパス計算が必要。
              pointData = getPointAtDistance(
                currentSegment.latlngs,
                Math.max(
                  0,
                  Math.min(currentSegment.distance, carCenterDistance)
                )
              );
            }

            if (!pointData) continue;

            var carLatLng = pointData.latlng;
            var carHeading = pointData.heading;
            if (train.direction === -1) {
              carHeading = (carHeading + 180) % 360;
            }

            var carLengthPx = metersToPixels(
              CONFIG.trainCarDimensionsMeters.length,
              carLatLng
            );
            var carWidthPx = metersToPixels(
              CONFIG.trainCarDimensionsMeters.width,
              carLatLng
            );
            var iconSizePx = Math.max(carLengthPx, carWidthPx) + 4; // アイコン全体のサイズに少し余裕を持たせる
            var rotation = carHeading - 90;

            // 車両の画像URLを決定
            var trainConfig = CONFIG.trains.find(function (t) {
              return t.id === train.type;
            });
            // SVGデータURIを動的に生成
            var imageUrl = generateTrainImageSVG(
              j === 0 ? "front" : "middle",
              trainConfig.trainColor,
              carLengthPx,
              carWidthPx
            );

            // L.divIcon を使用して img タグを埋め込む
            var carIcon = L.divIcon({
              className: "train-car-container",
              html:
                '<img src="' +
                imageUrl +
                '" style="width:' +
                carLengthPx +
                "px; height:" +
                carWidthPx +
                'px; display: block; object-fit: contain;">',
              iconSize: [iconSizePx, iconSizePx], // アイコン全体のサイズ
              iconAnchor: [iconSizePx / 2, iconSizePx / 2], // 中心をアンカーに
            });

            if (!train.carMarkers[j]) {
              // 初回作成
              train.carMarkers[j] = L.rotatedMarker(carLatLng, {
                icon: carIcon,
                rotation: rotation,
              }).addTo(map);
            } else {
              // 更新
              train.carMarkers[j].setLatLng(carLatLng);
              train.carMarkers[j].setRotation(rotation);

              // アイコンの画像ソースとサイズを更新
              // L.divIconのhtmlが変更された場合は、新しいアイコンをセットし直す
              var currentIcon = train.carMarkers[j].options.icon;
              if (
                currentIcon.options.html !== carIcon.options.html ||
                currentIcon.options.iconSize[0] !== carIcon.options.iconSize[0]
              ) {
                train.carMarkers[j].setIcon(carIcon);
              }
            }

            // 先頭車両にのみポップアップを設定/更新
            if (j === 0) {
              var popupContent =
                "<b>" +
                train.name +
                "</b><br>" +
                "路線: " +
                line.name +
                "<br>" +
                "速度: " +
                train.speed +
                "km/h<br>" +
                "乗客: " +
                train.currentPassengers.length +
                "/" +
                train.maxCapacity +
                "人";
              if (!train.carMarkers[j].getPopup()) {
                train.carMarkers[j].bindPopup(popupContent);
              } else {
                train.carMarkers[j].getPopup().setContent(popupContent);
              }
            }
          }
        }
      }

      // --- SAVE / LOAD GAME (共有機能対応のため、関数を分割・共通化) ---

      function serializeLatLng(latlng) {
        return latlng ? { lat: latlng.lat, lng: latlng.lng } : null;
      }
      function deserializeLatLng(obj) {
        return obj ? L.latLng(obj.lat, obj.lng) : null;
      }
      function serializeLatLngs(latlngs) {
        return (latlngs || []).map(serializeLatLng);
      }
      function deserializeLatLngs(arr) {
        return (arr || []).map(deserializeLatLng);
      }

      /**
       * 現在のゲーム状態から保存可能なオブジェクトを生成する。
       * Leafletレイヤーオブジェクトなどは除外し、再構築に必要なデータのみを抽出。
       * @returns {object} 保存可能なゲーム状態オブジェクト。
       */
      function getSavableState() {
        return {
          assets: state.assets,
          tracks: state.tracks.map(function (t) {
            return {
              id: t.id,
              latlngs: serializeLatLngs(t.latlngs),
              type: t.type,
            };
          }),
          stations: state.stations.map(function (s) {
            return {
              id: s.id,
              name: s.name,
              latlng: serializeLatLng(s.latlng),
              latlngs: serializeLatLngs(s.latlngs),
              platformLength: s.platformLength,
              revenueMultiplier: s.revenueMultiplier,
              passengersWaiting: s.passengersWaiting,
              maxWaitingPassengers: s.maxWaitingPassengers,
            };
          }),
          lines: state.lines.map(function (l) {
            return {
              id: l.id,
              name: l.name,
              stationIds: l.stationIds,
              color: l.color,
              totalDistance: l.totalDistance,
              assignedTrainIds: l.assignedTrainIds,
              segments: l.segments.map(function (seg) {
                return {
                  startStationId: seg.startStationId,
                  endStationId: seg.endStationId,
                  latlngs: serializeLatLngs(seg.latlngs),
                  distance: seg.distance,
                };
              }),
              totalTrainsOnLine: l.totalTrainsOnLine,
              totalCarsOnLine: l.totalCarsOnLine,
            };
          }),
          trains: state.trains.map(function (t) {
            return {
              id: t.id,
              type: t.type,
              name: t.name,
              cars: t.cars,
              cost: t.cost,
              trainColor: t.trainColor, // SVG生成用にtrainColorを保持
              speed: t.speed,
              totalLength: t.totalLength,
              currentStationId: t.currentStationId,
              currentLineId: t.currentLineId,
              currentSegmentIndex: t.currentSegmentIndex,
              direction: t.direction,
              progress: t.progress,
              isStopped: t.isStopped,
              currentPassengers: t.currentPassengers,
              maxCapacity: t.maxCapacity,
            };
          }),
          currentLineColorIndex: state.currentLineColorIndex,
          gameSpeedMultiplier: state.gameSpeedMultiplier,
          gameTime: state.gameTime, // ゲーム時間を保存
        };
      }

      /** マップ上の全てのLeafletレイヤーをクリアする */
      function clearMapLayers() {
        map.eachLayer(function (layer) {
          // ベースのタイルレイヤーと人口密度レイヤーは残す
          if (
            layer instanceof L.TileLayer ||
            (populationDensityLayer && layer === populationDensityLayer)
          ) {
            // Keep the base tile layer and population density layer
          } else {
            map.removeLayer(layer);
          }
        });
        // train.carMarkersも明示的にクリア
        for (var i = 0; i < state.trains.length; i++) {
          var train = state.trains[i];
          if (train.carMarkers) {
            for (var j = 0; j < train.carMarkers.length; j++) {
              if (train.carMarkers[j] && map.hasLayer(train.carMarkers[j])) {
                map.removeLayer(train.carMarkers[j]);
              }
            }
          }
          train.carMarkers = []; // クリア
        }
      }

      // --- 暗号化/復号化のヘルパー関数 ---
      // 注意: このXOR暗号化は非常に簡易的なものであり、セキュリティレベルは高くありません。
      // 鍵がコード内にハードコードされているため、本格的なセキュリティが必要な場合は、
      // より強力な暗号化ライブラリの導入と、鍵管理の仕組みが必要です。
      var encryptionKey = "RailBuilderSecretKey2023"; // 適当な鍵

      function xorEncryptDecrypt(data, key) {
        var output = "";
        for (var i = 0; i < data.length; i++) {
          var charCode = data.charCodeAt(i) ^ key.charCodeAt(i % key.length);
          output += String.fromCharCode(charCode);
        }
        return output;
      }

      /**
       * ロードされたデータオブジェクトからゲーム状態を復元する。
       * @param {object} loadedState - ロードするゲーム状態オブジェクト。
       * @returns {boolean} ロードが成功したかどうか。
       */
      function loadGameFromObject(loadedState) {
        if (!loadedState) {
          ui.showMessage("無効なゲームデータです。", "error", false, 3000);
          return false;
        }

        clearMapLayers();

        // Reset state
        state = {
          assets: loadedState.assets,
          tracks: [],
          stations: [],
          lines: [],
          trains: [],
          planning: { type: null, points: [], ghost: null, costTooltip: null },
          lineBuildingMode: false,
          selectedStationsForLine: [],
          currentLineGhost: null,
          selectedTrainToBuyId: null,
          currentLineColorIndex: loadedState.currentLineColorIndex || 0,
          selectedTrainToAssignId: null,
          demolitionMode: false,
          selectedForDemolition: null,
          gameSpeedMultiplier: loadedState.gameSpeedMultiplier || 1,
          trainUpdateIntervalId: null,
          passengerGenerationIntervalId: null,
          gameTime: loadedState.gameTime || 0, // ゲーム時間をロード
          gameTimeIntervalId: null,
        };

        var i;

        // Rebuild tracks
        for (i = 0; i < loadedState.tracks.length; i++) {
          var tData = loadedState.tracks[i];
          var latlngs = deserializeLatLngs(tData.latlngs);

          var railLayer = L.polyline(latlngs, {
            className: "track-rail track-" + tData.type + "-rail",
            id: tData.id,
          }).addTo(map);
          var sleeperLayer = L.polyline(latlngs, {
            className: "track-sleeper track-" + tData.type + "-sleeper",
            id: tData.id,
          }).addTo(map);

          state.tracks.push({
            id: tData.id,
            latlngs: latlngs,
            railLayer: railLayer,
            sleeperLayer: sleeperLayer,
            type: tData.type,
          });

          railLayer.on("click", function (e) {
            e.originalEvent.stopPropagation();
            if (state.demolitionMode) {
              selectForDemolition("track", this.options.id);
            }
          });
          sleeperLayer.on("click", function (e) {
            e.originalEvent.stopPropagation();
            if (state.demolitionMode) {
              selectForDemolition("track", e.target.options.id);
            }
          });
        }

        // Rebuild stations
        for (i = 0; i < loadedState.stations.length; i++) {
          var sData = loadedState.stations[i];
          var latlng = deserializeLatLng(sData.latlng);
          var latlngs = deserializeLatLngs(sData.latlngs);

          var platformBodyLayer = L.polyline(latlngs, {
            className: "station-platform-body",
            id: sData.id,
          }).addTo(map);
          var platformEdgeLayer = L.polyline(latlngs, {
            className: "station-platform-edge",
            id: sData.id,
          }).addTo(map);

          var marker = L.marker(latlng, {
            icon: L.divIcon({
              className: "station-marker",
              iconSize: [16, 16],
              html: "",
            }),
            id: sData.id,
          }).addTo(map);
          var newStation = {
            id: sData.id,
            name: sData.name,
            latlng: latlng,
            latlngs: latlngs,
            platformLength: sData.platformLength,
            bodyLayer: platformBodyLayer,
            edgeLayer: platformEdgeLayer,
            marker: marker,
            revenueMultiplier: sData.revenueMultiplier || 1.0,
            passengersWaiting: sData.passengersWaiting || [],
            maxWaitingPassengers:
              sData.maxWaitingPassengers ||
              Math.floor(
                sData.platformLength *
                  CONFIG.maxWaitingPassengersPerMeterOfPlatform
              ),
          };
          state.stations.push(newStation);

          // 駅名ツールチップをバインド
          marker.bindTooltip(newStation.name, {
            permanent: true,
            direction: "top",
            className: "station-name-tooltip",
          });
          marker.getTooltip()._container.style.display =
            map.getZoom() >= 13 ? "block" : "none";

          marker.on("click", function (e) {
            e.originalEvent.stopPropagation();
            var id = e.target.options.id;
            if (state.lineBuildingMode) {
              handleStationClickForLineBuilding(id);
            } else if (state.demolitionMode) {
              selectForDemolition("station", id);
            } else {
              // 修正4: 通常クリック時にポップアップを開く
              e.target.openPopup();
            }
          });
          platformBodyLayer.on("click", function (e) {
            e.originalEvent.stopPropagation();
            var id = e.target.options.id;
            if (state.demolitionMode) {
              selectForDemolition("station", id);
            }
          });
          platformEdgeLayer.on("click", function (e) {
            e.originalEvent.stopPropagation();
            var id = e.target.options.id;
            if (state.demolitionMode) {
              selectForDemolition("station", id);
            }
          });
          setStationRevenueMultiplier(newStation); // ロード時にも人口密度を適用
        }

        // Rebuild lines
        for (i = 0; i < loadedState.lines.length; i++) {
          var lData = loadedState.lines[i];
          var linePathLatLngs = [];
          if (lData.segments && lData.segments.length > 0) {
            linePathLatLngs = deserializeLatLngs(lData.segments[0].latlngs);
            for (var j = 1; j < lData.segments.length; j++) {
              var segLatLngs = deserializeLatLngs(lData.segments[j].latlngs);
              Array.prototype.push.apply(
                linePathLatLngs,
                segLatLngs.slice(1)
              );
            }
          }
          var lineLayer = L.polyline(linePathLatLngs, {
            className: "line-color",
            color: lData.color,
            weight: 5,
            opacity: 0.8,
            id: lData.id,
          }).addTo(map);
          state.lines.push({
            id: lData.id,
            name: lData.name,
            stationIds: lData.stationIds,
            color: lData.color,
            layer: lineLayer,
            totalDistance: lData.totalDistance,
            assignedTrainIds: lData.assignedTrainIds,
            segments: lData.segments.map(function (seg) {
              return {
                startStationId: seg.startStationId,
                endStationId: seg.endStationId,
                latlngs: deserializeLatLngs(seg.latlngs),
                distance: seg.distance,
              };
            }),
            totalTrainsOnLine: lData.totalTrainsOnLine || 0,
            totalCarsOnLine: lData.totalCarsOnLine || 0,
          });
        }

        // Rebuild trains
        for (i = 0; i < loadedState.trains.length; i++) {
          var trainData = loadedState.trains[i];
          var newTrain = Object.assign({}, trainData);
          newTrain.stopTimer = null;
          newTrain.carMarkers = []; // ロード時には空にして、renderTrainsで再作成させる
          newTrain.currentLatLng = null; // will be calculated on next update
          newTrain.currentHeading = 0;
          state.trains.push(newTrain);
        }

        ui.updateFinance();
        ui.updateGameTimeDisplay(); // ゲーム時間も更新
        ui.renderTrainShop();
        renderTrains();
        setGameSpeed(state.gameSpeedMultiplier); // ロード後にゲーム速度を再設定
        return true;
      }

      /** ゲームの状態をローカルストレージに保存する。 */
      function saveGame() {
        var savableState = getSavableState();
        try {
          var jsonString = JSON.stringify(savableState);
          var encrypted = xorEncryptDecrypt(jsonString, encryptionKey); // 暗号化
          var compressedAndEncrypted = LZString.compressToBase64(encrypted); // 圧縮

          localStorage.setItem("railBuilderSaveGame", compressedAndEncrypted);
          ui.showMessage("ゲームをセーブしました！ (ローカル)", "success", false, 2000);
        } catch (e) {
          console.error("ゲームのセーブに失敗しました:", e);
          ui.showMessage("ゲームのセーブに失敗しました。", "error", false, 3000);
        }
      }

      /** ローカルストレージからゲームの状態をロードする。 */
      function loadGame() {
        ui.showLoadingOverlay("ゲームデータをロード中...");
        var savedData = localStorage.getItem("railBuilderSaveGame");
        if (!savedData) {
          ui.showMessage("保存されたゲームデータがありません。", "warning", false, 3000);
          ui.hideLoadingOverlay();
          return;
        }
        try {
          var decompressed = LZString.decompressFromBase64(savedData); // 解凍
          if (!decompressed) {
            throw new Error("LZ-String decompression failed.");
          }
          var decrypted = xorEncryptDecrypt(decompressed, encryptionKey); // 復号化
          var loadedState = JSON.parse(decrypted);

          if (loadGameFromObject(loadedState)) {
            ui.showMessage(
              "セーブデータを入力し、ゲームをロードしました！",
              "success",
              false,
              2000
            );
            ui.saveDataTextarea.value = ""; // ロード後クリア
          }
        } catch (e) {
          console.error("ゲームのロードに失敗しました:", e);
          ui.showMessage(
            "ゲームのロードに失敗しました。データが破損している可能性があります。",
            "error",
            false,
            5000
          );
        } finally {
          ui.hideLoadingOverlay();
        }
      }

      /** 現在のゲーム状態をJSONテキストとしてテキストエリアに出力する。 */
      function exportSaveData() {
        try {
          var savableState = getSavableState();
          var jsonString = JSON.stringify(savableState);
          var encrypted = xorEncryptDecrypt(jsonString, encryptionKey); // 暗号化
          var compressedAndEncrypted = LZString.compressToBase64(encrypted); // 圧縮

          ui.saveDataTextarea.value = compressedAndEncrypted;
          ui.showMessage(
            "セーブデータを出力しました。テキストエリアからコピーしてください。",
            "info",
            false,
            3000
          );
        } catch (e) {
          console.error("セーブデータのエクスポートに失敗しました:", e);
          ui.showMessage("セーブデータのエクスポートに失敗しました。", "error", false, 3000);
        }
      }

      /** テキストエリアのJSONテキストからゲーム状態をインポートする。 */
      function importSaveData() {
        ui.showLoadingOverlay("セーブデータをインポート中...");
        var compressedAndEncrypted = ui.saveDataTextarea.value;
        if (!compressedAndEncrypted) {
          ui.showMessage(
            "テキストエリアにセーブデータを貼り付けてください。",
            "warning",
            false,
            3000
          );
          ui.hideLoadingOverlay();
          return;
        }
        try {
          var decompressed = LZString.decompressFromBase64(
            compressedAndEncrypted
          ); // 解凍
          if (!decompressed) {
            throw new Error("LZ-String decompression failed.");
          }
          var decrypted = xorEncryptDecrypt(decompressed, encryptionKey); // 復号化
          var loadedState = JSON.parse(decrypted);

          if (loadGameFromObject(loadedState)) {
            ui.showMessage(
              "セーブデータを入力し、ゲームをロードしました！",
              "success",
              false,
              2000
            );
            ui.saveDataTextarea.value = ""; // ロード後クリア
          }
        } catch (e) {
          console.error("セーブデータのインポートに失敗しました:", e);
          ui.showMessage(
            "無効なセーブデータです。形式を確認してください。",
            "error",
            false,
            5000
          );
        } finally {
          ui.hideLoadingOverlay();
        }
      }

      // ===================================================================
      // 人口密度TIFF関連の機能追加
      // ===================================================================

      // グローバル変数としてGeoTIFFオブジェクトとラスタデータを保持
      var populationDensityData = null; // 1次元配列で人口密度を保持
      var populationDensityGeoTransform = null; // [minX, minY, maxX, maxY]
      var populationDensityWidth = 0;
      var populationDensityHeight = 0;
      var populationDensityLayer = null; // Leafletの人口密度レイヤー

      var POPULATION_DENSITY_TIFF_PATH = "./zinkou.tif";

      // GeoTIFFを読み込み、ラスタデータをキャッシュ
      async function loadPopulationDensityTiff() {
        ui.showLoadingOverlay("人口密度データを読み込み中...");
        try {
          const tiff = await GeoTIFF.fromUrl(POPULATION_DENSITY_TIFF_PATH);
          const image = await tiff.getImage();

          let bbox = image.getBoundingBox();
          if (!Array.isArray(bbox)) {
            bbox = [bbox.left, bbox.bottom, bbox.right, bbox.top];
          }
          populationDensityGeoTransform = bbox;
          populationDensityWidth = image.getWidth();
          populationDensityHeight = image.getHeight();

          // 全ピクセルを読み込んで1次元配列に保持 (RangeError対策)
          const raster = await image.readRasters();
          populationDensityData = raster[0]; // raster[0] はすでに型付き配列

          console.log("TIFF Width:", populationDensityWidth);
          console.log("TIFF Height:", populationDensityHeight);
          console.log(
            "Raster data length:",
            populationDensityData ? populationDensityData.length : "null"
          ); // ここで長さを確認

          ui.showMessage(
            "人口密度データの読み込みが完了しました。",
            "success",
            false,
            3000
          );
          console.log(
            "Population Density TIFF loaded:",
            populationDensityGeoTransform,
            "Width:",
            populationDensityWidth,
            "Height:",
            populationDensityHeight
          );

          // 駅の収益倍率を更新
          for (let i = 0; i < state.stations.length; i++) {
            setStationRevenueMultiplier(state.stations[i]);
          }

          // 人口密度レイヤーを初期表示
          // addPopulationDensityLayer();
        } catch (error) {
          console.error("人口密度TIFFの読み込みに失敗しました:", error);
          ui.showMessage(
            "人口密度データの読み込みに失敗しました。ファイルパスを確認してください。",
            "error",
            false,
            7000
          );
        } finally {
          ui.hideLoadingOverlay();
        }
      }

      // 緯度経度 → ラスタ座標
      function latLngToPixel(latlng) {
        const [minX, minY, maxX, maxY] = populationDensityGeoTransform;
        // 経度方向の範囲が0の場合の対策
        const lngRange = maxX - minX;
        const latRange = maxY - minY;

        let x = 0;
        if (lngRange !== 0) {
          x = ((latlng.lng - minX) / lngRange) * populationDensityWidth;
        }
        let y = 0;
        if (latRange !== 0) {
          y = ((maxY - latlng.lat) / latRange) * populationDensityHeight;
        }

        return [Math.floor(x), Math.floor(y)];
      }

      // 人口密度を取得（キャッシュ配列から同期で取得）
      function getPopulationDensity(latlng) {
        if (
          !populationDensityData ||
          populationDensityWidth === 0 ||
          populationDensityHeight === 0 ||
          !populationDensityGeoTransform
        )
          return 0;

        // 緯度経度がGeoTIFFの範囲外の場合のチェック
        const [minX, minY, maxX, maxY] = populationDensityGeoTransform;
        if (
          latlng.lng < minX ||
          latlng.lng > maxX ||
          latlng.lat < minY ||
          latlng.lat > maxY
        ) {
          return 0; // 範囲外
        }

        const [x, y] = latLngToPixel(latlng);

        // 範囲チェックを強化
        if (
          x < 0 ||
          x >= populationDensityWidth ||
          y < 0 ||
          y >= populationDensityHeight
        ) {
          // console.warn("Pixel coordinates out of bounds:", x, y, "for LatLng:", latlng.lat, latlng.lng);
          return 0;
        }

        // 計算されるインデックスが配列の範囲内にあるか最終チェック
        const index = y * populationDensityWidth + x;
        if (index < 0 || index >= populationDensityData.length) {
          // console.error("Calculated index out of bounds:", index, "Array length:", populationDensityData.length, "for LatLng:", latlng.lat, latlng.lng);
          return 0;
        }

        return populationDensityData[index];
      }

      // 駅の収益倍率を設定
      function setStationRevenueMultiplier(station) {
        const density = getPopulationDensity(station.latlng);
        let multiplier = 1.0;

        if (density > 10000) multiplier = 2.5;
        else if (density > 5000) multiplier = 2.0;
        else if (density > 1000) multiplier = 1.5;
        else if (density > 500) multiplier = 1.0;
        else multiplier = 0.5;

        station.revenueMultiplier = multiplier;

        if (station.marker && station.marker.getPopup()) {
          // ★修正5: 駅のポップアップに待機乗客数と最大待機乗客数を表示
          station.marker
            .getPopup()
            .setContent(
              `<b>${station.name}</b><br>ID: ${station.id}<br>` +
                `プラットフォーム長: ${station.platformLength.toFixed(
                  1
                )}m<br>` +
                `人口密度: ${Math.round(density).toLocaleString()}人/km²<br>` +
                `収益倍率: ${station.revenueMultiplier.toFixed(2)}<br>` +
                `待機乗客: ${station.passengersWaiting.length}人<br>` +
                `最大待機乗客: ${station.maxWaitingPassengers}人`
            );
        }
      }

      // 人口密度カラー取得
      function getDensityColor(density) {
        if (density <= 0) return "rgba(0,0,0,0)";
        let r, g, b, a;
        if (density < 50) {
          const ratio = density / 50;
          r = 100 * ratio;
          g = 150 * ratio;
          b = 255;
          a = 0.1 + 0.3 * ratio;
        } else if (density < 500) {
          const ratio = (density - 50) / 450;
          r = 100 + 155 * ratio;
          g = 150 * (1 - ratio);
          b = 255 * (1 - ratio);
          a = 0.4 + 0.2 * ratio;
        } else if (density < 2000) {
          const ratio = (density - 500) / 1500;
          r = 255;
          g = Math.floor(100 * (1 - ratio)); // 修正: gを減らす
          b = Math.floor(100 * (1 - ratio)); // 修正: bを減らす
          a = 0.6 + 0.2 * ratio;
        } else {
          const ratio = Math.min(1, (density - 2000) / 8000);
          r = 255;
          g = Math.floor(100 * (1 - ratio));
          b = 100 + 155 * ratio;
          a = 0.8 + 0.1 * ratio;
        }
        return `rgba(${Math.floor(r)},${Math.floor(b)},${Math.floor(g)},${a})`; /* RGB順序を調整 */
      }

      // Leaflet人口密度レイヤー
      L.GridLayer.PopulationDensity = L.GridLayer.extend({
        options: { tileSize: 256, opacity: 0.6, samplingResolution: 24 },
        createTile: function (coords) {
          const tile = L.DomUtil.create("canvas", "leaflet-tile");
          tile.width = tile.height = this.options.tileSize;
          const ctx = tile.getContext("2d");
          if (!populationDensityData) return tile;

          const step = this.options.tileSize / this.options.samplingResolution; // より細かいグリッドで描画
          for (let x = 0; x < this.options.tileSize; x += step) {
            for (let y = 0; y < this.options.tileSize; y += step) {
              const mapPixelX = coords.x * this.options.tileSize + x;
              const mapPixelY = coords.y * this.options.tileSize + y;
              const latlng = map.unproject([mapPixelX, mapPixelY], coords.z);
              const density = getPopulationDensity(latlng);
              if (density > 0) {
                ctx.fillStyle = getDensityColor(density);
                ctx.fillRect(x, y, step, step);
              }
            }
          }
          return tile;
        },
      });

      L.gridLayer.populationDensity = function (options) {
        return new L.GridLayer.PopulationDensity(options);
      };

      function addPopulationDensityLayer() {
        if (populationDensityLayer) map.removeLayer(populationDensityLayer);
        populationDensityLayer = L.gridLayer
          .populationDensity({ opacity: 0.6 })
          .addTo(map);
        populationDensityLayer.setZIndex(1);
      }

      // ===================================================================
      // チュートリアル機能
      // ===================================================================
      var tutorialSteps = [
        {
          title: "Rail Builder Proへようこそ！",
          icon: "fas fa-train",
          text: "このゲームでは、線路や駅を建設し、列車を運行して都市を発展させます。まずは基本的な操作を学びましょう。",
        },
        {
          title: "1. 線路の建設",
          icon: "fas fa-road",
          text: "左側の「建設メニュー」から「地上線」「高架線」「トンネル」を選び、マップ上でドラッグして線路を建設します。建設コストに注意しましょう。",
        },
        {
          title: "2. 駅の建設",
          icon: "fas fa-train-station",
          text: "「建設メニュー」から「駅」を選び、マップ上でドラッグして駅のプラットフォームを建設します。駅は乗客の乗り降りや収益の拠点となります。",
        },
        {
          title: "3. 列車ショップ",
          icon: "fas fa-cart-shopping",
          text: "「列車ショップ」では、様々な種類の列車を購入できます。資金と相談して、最適な列車を選びましょう。",
        },
        {
          title: "4. 路線設定",
          icon: "fas fa-route",
          text: "「路線設定」モードで駅を順番にクリックし、路線を作成します。作成した路線に列車を割り当てることで運行が開始されます。",
        },
        {
          title: "5. 解体モード",
          icon: "fas fa-hammer",
          text: "「解体モード」では、建設済みの線路や駅を撤去できます。不要な施設を整理し、都市計画を見直しましょう。",
        },
        {
          title: "6. 資金と時間",
          icon: "fas fa-dollar-sign",
          text: "右上の「資産」と「時間」はゲームの進行状況を示します。乗客を運び、収益を上げて資産を増やしましょう。ゲーム速度も調整できます。",
        },
        {
          title: "7. 人口密度と収益",
          icon: "fas fa-users",
          text: "駅周辺の人口密度が高いほど、より多くの乗客が生成され、収益も増加します。人口密度の高い地域に駅を建設するのがおすすめです。",
        },
        {
          title: "ゲーム開始！",
          icon: "fas fa-play",
          text: "これで基本的な操作はマスターしました。さあ、あなただけの鉄道王国を築き上げましょう！",
        },
      ];
      var currentTutorialStep = 0;

      function showTutorial() {
        document.getElementById("tutorial-overlay").classList.add("show");
        showTutorialStep(0);
        // チュートリアル中はマップ操作を無効化
        map.dragging.disable();
        map.doubleClickZoom.disable();
        map.scrollWheelZoom.disable();
        map.boxZoom.disable();
        map.keyboard.disable();
        if (map.tap) map.tap.disable();
        if (map.touchZoom) map.touchZoom.disable();
        if (map.zoomControl) map.zoomControl.disable();
      }

      function hideTutorial() {
        document.getElementById("tutorial-overlay").classList.remove("show");
        localStorage.setItem("hasSeenTutorial", "true");
        // チュートリアル終了後、マップ操作を有効化
        map.dragging.enable();
        map.doubleClickZoom.enable();
        map.scrollWheelZoom.enable();
        map.boxZoom.enable();
        map.keyboard.enable();
        if (map.tap) map.tap.enable();
        if (map.touchZoom) map.tap.enable(); // tapを有効化
        if (map.zoomControl) map.zoomControl.enable();
      }

      function showTutorialStep(stepIndex) {
        if (stepIndex < 0 || stepIndex >= tutorialSteps.length) return;

        currentTutorialStep = stepIndex;
        var step = tutorialSteps[currentTutorialStep];

        document.getElementById("tutorial-title").textContent = step.title;
        document.getElementById("tutorial-icon").className =
          step.icon + " tutorial-icon";
        document.getElementById("tutorial-text").textContent = step.text;

        document.getElementById("tutorial-prev-btn").disabled =
          currentTutorialStep === 0;
        document.getElementById("tutorial-next-btn").textContent =
          currentTutorialStep === tutorialSteps.length - 1
            ? "完了"
            : "次へ";
        document.getElementById("tutorial-next-btn").querySelector("i").className =
          currentTutorialStep === tutorialSteps.length - 1
            ? "fas fa-check"
            : "fas fa-chevron-right";
      }

      function initTutorial() {
        document
          .getElementById("tutorial-next-btn")
          .addEventListener("click", function () {
            if (currentTutorialStep === tutorialSteps.length - 1) {
              hideTutorial();
            } else {
              showTutorialStep(currentTutorialStep + 1);
            }
          });

        document
          .getElementById("tutorial-prev-btn")
          .addEventListener("click", function () {
            showTutorialStep(currentTutorialStep - 1);
          });

        document
          .getElementById("tutorial-skip-btn")
          .addEventListener("click", hideTutorial);

        if (!localStorage.getItem("hasSeenTutorial")) {
          showTutorial();
        }
      }

      // --- INITIAL LOAD ---
      document.addEventListener("DOMContentLoaded", function () {
        // 各列車タイプにSVGデータURIを設定
        CONFIG.trains.forEach(function (train) {
          // 初期描画サイズは適当な値で設定。renderTrainsで実際のピクセルサイズに調整される。
          // ここではSVGの生成に必要な最低限のサイズを与える。
          train.frontCarImage = generateTrainImageSVG(
            "front",
            train.trainColor,
            CONFIG.trainCarDimensionsMeters.length * 2, // 例: 2倍のピクセルサイズ
            CONFIG.trainCarDimensionsMeters.width * 2
          );
          train.middleCarImage = generateTrainImageSVG(
            "middle",
            train.trainColor,
            CONFIG.trainCarDimensionsMeters.length * 2,
            CONFIG.trainCarDimensionsMeters.width * 2
          );
        });

        loadPopulationDensityTiff().then(function () {
          setGameSpeed(1); // 初期速度は1倍
          initTutorial(); // チュートリアルを初期化
        });
      });
    </script>
  </body>
</html>
